--!optimize 2
--!nolint
-- This script was automatically @generated by Maui, it is not intended for manual editing.
local ModuleRoot = {
    ClassName = "ModuleScript",
    Closure = function()
        -- Configuration and constants
        local Config = {
            KEY_LINK = "Key link not loaded! Please wait and try again.",
            WHITELIST_LINK = "Whitelist link not loaded! Please wait and try again.",
            DISCORD_INVITE = "https://dsc.gg/cielberm"
        }
        
        -- Window dimensions
        local WindowSize = Vector2.new(800, 480)
        
        -- Camera reference
        local CurrentCamera = workspace.CurrentCamera
        
        -- UI references
        local PlayerGui = script:WaitForChild("Player")
        local Resources = script:WaitForChild("Resources")
        local Renderer = PlayerGui.Renderer
        local SurfaceGui = Renderer.Surface
        
        -- Update camera reference when it changes
        workspace:GetPropertyChangedSignal("CurrentCamera"):Connect(function()
            CurrentCamera = workspace.CurrentCamera
        end)
        
        local ScreenContainer = PlayerGui.ScreenContainer
        local HubPosition = ScreenContainer.HubPosition
        local LoginWindow = SurfaceGui.Window.Content.Login.LoginBox.LoginLayout.KeyField
        local KeyInput = LoginWindow.Key
        local ModalsContainer = SurfaceGui.Window.Modals
        local ColorModal = SurfaceGui.Window.ColorModal
        local Sidebar = SurfaceGui.Window.Content.Hub.MainContent.PageView.Home.Sidebar
        local PageContents = SurfaceGui.Window.Content.Hub.MainContent.PageView.Home.PageBase.PageContents
        local SubtitleText = SurfaceGui.Window.Content.TopBar.LogoTitle.Subtitle.SubText
        local VersionText = SurfaceGui.Window.Content.TopBar.LogoTitle.Subtitle.Version
        local ThemeColors = Resources.Themes.Cielberm.Colors
        local ColorPickerUI = ColorModal.ColorPickerUI
        local BasicColors = ColorPickerUI.Basic
        local AdvancedColors = ColorPickerUI.Advanced
        local ColorPickerTitle = ColorPickerUI.TopBar.Title.Subtitle
        local MinimizedTask = PlayerGui.MinimizedTask
        local TweenService = game:GetService("TweenService")
        
        -- State variables
        local EventHandlers = {}
        local CurrentTooltip = nil
        local ButtonCallbacks = {}
        local PageCallbacks = {}
        local SectionCallbacks = {}
        local ElementCallbacks = {}
        local DropdownCallbacks = {}
        
        -- Remove script from hierarchy
        script.Parent = nil
        
        -- Tooltip system
        local TooltipContainer = SurfaceGui.Window.TooltipContainer
        local TooltipHideTween = TweenService:Create(
            TooltipContainer,
            TweenInfo.new(0.5, Enum.EasingStyle.Quad, Enum.EasingDirection.In, 0, false, 0.5),
            {Size = UDim2.fromOffset(0)}
        )
        local TooltipFrame = TooltipContainer.Frame.TextBubble
        local TooltipLabel = TooltipFrame.Label
        local TooltipLayout = TooltipFrame.UIListLayout
        local TailContainer = TooltipLabel.TailContainer
        local TailLeftClip = TailContainer.TailLeftClip
        local TailRightClip = TailContainer.TailRightClip
        local TailLeft = TailLeftClip.Frame
        local TailRight = TailRightClip.Frame
        local CurrentTooltipTarget
        local TooltipCount = 0
        
        -- Create bindable events
        do
            local EventNames = {"LoginRequest", "MinimizedChanged", "SizeChanged", "Opened", "Closing", "HubDestroying", "WhitelistChanged"}
            for _, EventName in next, EventNames do
                local Event = Instance.new("BindableEvent")
                Event.Name = EventName
                Event.Parent = Resources.Bindables
            end
        end
        
        -- 3D surface positioning
        local RenderConnection
        do
            local OffsetCFrame = CFrame.new(0, 0, -50)
            local TempPart = Instance.new("Part")
            TempPart.Size = Vector3.zero
            local SurfaceOffset = CFrame.new(0, 0, -TempPart.Size.Z/2)
            TempPart:Destroy()
            TempPart = nil
            
            local LastCameraCFrame
            local LastAbsoluteSize
            local LastAbsolutePosition
            local LastFieldOfView
            local ObjectSpacePosition
            
            RenderConnection = game:GetService("RunService").PreRender:Connect(function()
                local CameraCFrame = CurrentCamera:GetRenderCFrame()
                
                -- Update surface size and position when needed
                if CurrentCamera.FieldOfView ~= LastFieldOfView or HubPosition.AbsoluteSize ~= LastAbsoluteSize or HubPosition.AbsolutePosition ~= LastAbsolutePosition then
                    local InverseCameraCFrame = CameraCFrame:ToObjectSpace(CFrame.new(CameraCFrame.Position)):Inverse()
                    local LookOffset = (CameraCFrame * OffsetCFrame).Position
                    local LookVector = CameraCFrame.LookVector
                    
                    -- Calculate screen corners
                    local CenterOffsetX = PlayerGui.AbsoluteSize.X % 2 == 0 and 0 or 0.5
                    local CenterOffsetY = PlayerGui.AbsoluteSize.Y % 2 == 0 and 0 or 0.5
                    
                    local TopLeftRay = CurrentCamera:ScreenPointToRay(
                        HubPosition.AbsolutePosition.X + CenterOffsetX, 
                        HubPosition.AbsolutePosition.Y + CenterOffsetY, 
                        0
                    )
                    local TopRightRay = CurrentCamera:ScreenPointToRay(
                        HubPosition.AbsolutePosition.X + HubPosition.AbsoluteSize.X + CenterOffsetX, 
                        HubPosition.AbsolutePosition.Y + CenterOffsetY, 
                        0
                    )
                    local BottomLeftRay = CurrentCamera:ScreenPointToRay(
                        HubPosition.AbsolutePosition.X + CenterOffsetX, 
                        HubPosition.AbsolutePosition.Y + HubPosition.AbsoluteSize.Y + CenterOffsetY, 
                        0
                    )
                    
                    -- Calculate intersection points
                    local TopLeftPoint = TopLeftRay.Origin + TopLeftRay.Direction * 
                        (LookOffset - TopLeftRay.Origin):Dot(LookVector) / TopLeftRay.Direction:Dot(LookVector)
                    local TopRightPoint = TopRightRay.Origin + TopRightRay.Direction * 
                        (LookOffset - TopRightRay.Origin):Dot(LookVector) / TopRightRay.Direction:Dot(LookVector)
                    local BottomLeftPoint = BottomLeftRay.Origin + BottomLeftRay.Direction * 
                        (LookOffset - BottomLeftRay.Origin):Dot(LookVector) / BottomLeftRay.Direction:Dot(LookVector)
                    
                    -- Update surface size and position
                    SurfaceGui.Size = Vector3.new(
                        (TopRightPoint - TopLeftPoint).magnitude,
                        (BottomLeftPoint - TopLeftPoint).magnitude,
                        0
                    )
                    
                    ObjectSpacePosition = CameraCFrame:PointToObjectSpace((BottomLeftPoint + TopRightPoint) / 2)
                    SurfaceGui.CFrame = CameraCFrame * CFrame.new(ObjectSpacePosition) * SurfaceOffset
                    
                    LastFieldOfView = CurrentCamera.FieldOfView
                    LastAbsoluteSize = HubPosition.AbsoluteSize
                end
                
                -- Update position when camera moves
                if CameraCFrame ~= LastCameraCFrame or HubPosition.AbsolutePosition ~= LastAbsolutePosition then
                    SurfaceGui.CFrame = CameraCFrame * CFrame.new(ObjectSpacePosition) * SurfaceOffset
                    LastCameraCFrame = CameraCFrame
                    LastAbsolutePosition = HubPosition.AbsolutePosition
                end
                
                -- Clean up if parent is destroyed
                if not HubPosition.Parent or not SurfaceGui.Parent or not SurfaceGui.Window.Parent or not PlayerGui.Parent then
                    Cleanup()
                end
            end)
        end
        
        -- Initialize surface after render frames
        coroutine.resume(coroutine.create(function()
            game:GetService("RunService").PreRender:Wait()
            game:GetService("RunService").PreAnimation:Wait()
            SurfaceGui.Parent = nil
            SurfaceGui.Parent = Renderer
        end))
        
        -- Create tweens
        do
            local TweenDefinitions = {
                GuiFull = TweenService:Create(ScreenContainer, TweenInfo.new(0.2, Enum.EasingStyle.Quint), {Size = UDim2.fromScale(1, 1)}),
                GuiHalf = TweenService:Create(ScreenContainer, TweenInfo.new(0.2, Enum.EasingStyle.Quint), {Size = UDim2.fromScale(0.5, 0.5)}),
                GuiEnterFull = TweenService:Create(ScreenContainer, TweenInfo.new(), {Size = UDim2.fromScale(1, 1)}),
                GuiEnterHalf = TweenService:Create(ScreenContainer, TweenInfo.new(), {Size = UDim2.fromScale(0.5, 0.5)}),
                GuiExit = TweenService:Create(ScreenContainer, TweenInfo.new(), {Size = UDim2.fromOffset()}),
                CanvasFull = TweenService:Create(SurfaceGui, TweenInfo.new(), {CanvasSize = WindowSize}),
                CanvasMin = TweenService:Create(SurfaceGui, TweenInfo.new(), {CanvasSize = Vector2.zero}),
                AdvancedColorsEnter = TweenService:Create(ColorPickerUI, TweenInfo.new(0.5), {Size = UDim2.fromOffset(576, 384)}),
                AdvancedColorsExit = TweenService:Create(ColorPickerUI, TweenInfo.new(0.5), {Size = UDim2.fromOffset(384, 384)}),
                ModalShadeFadeIn = TweenService:Create(ModalsContainer, TweenInfo.new(0.5), {BackgroundTransparency = 0.4}),
                ModalShadeFadeOut = TweenService:Create(ModalsContainer, TweenInfo.new(0.5), {BackgroundTransparency = 1}),
                ColorModalShadeFadeIn = TweenService:Create(ColorModal, TweenInfo.new(0.5), {BackgroundTransparency = 0.4}),
                ColorModalShadeFadeOut = TweenService:Create(ColorModal, TweenInfo.new(0.5), {BackgroundTransparency = 1}),
                ColorPickerOpen = TweenService:Create(ColorPickerUI, TweenInfo.new(0.25), {Position = UDim2.fromScale(0.5, 0.5), AnchorPoint = Vector2.new(0.5, 0.5)}),
                ColorPickerClose = TweenService:Create(ColorPickerUI, TweenInfo.new(0.25), {Position = UDim2.fromScale(0.5, 1), AnchorPoint = Vector2.new(0.5)})
            }
            
            for TweenName, Tween in next, TweenDefinitions do
                Tween.Name = TweenName
                Tween.Parent = Resources.Tweens
            end
        end
        
        -- Executor compatibility check
        do
            local UnsupportedExecutors = {solara = true}
            if identifyexecutor then
                local ExecutorName = identifyexecutor()
                if UnsupportedExecutors[ExecutorName:lower()] then
                    -- This would show a dialog if the Window object was available
                    -- Window:ShowDialog({
                    --     Title = "Executor Unsupported!",
                    --     Text = ExecutorName.." is not supported by our key system! Please use another executor.\nThis window will now close.",
                    --     Buttons = {{Title = "OK", Callback = Window.Close}}
                    -- })
                end
            end
        end
        
        -- Background handling with lavender theme
        local LoginBackground = SurfaceGui.Window.Content.Login.Background
        local HubBackground = SurfaceGui.Window.Content.Hub.Background
        
        SurfaceGui:GetPropertyChangedSignal("CanvasSize"):Connect(function()
            LoginBackground.Visible = false
            LoginBackground.Visible = true
            HubBackground.Visible = false
            HubBackground.Visible = true
        end)
        
        -- Loading animation
        game.TweenService:Create(
            SurfaceGui.Window.LoadingScreen.LoadingCircle.UIStroke.UIGradient,
            TweenInfo.new(1, Enum.EasingStyle.Linear, Enum.EasingDirection.Out, -1),
            {Rotation = 360}
        ):Play()
        
        -- Day/night background based on time with lavender theme
        local CurrentHour = os.date("*t").hour
        if CurrentHour >= 6 and CurrentHour < 18 then
            LoginBackground.SkyNight.Visible = false
            LoginBackground.SkyDay.Visible = true
            LoginBackground.GradientNight.Enabled = false
            LoginBackground.GradientDay.Enabled = true
            
            -- Update gradient colors to lavender theme
            LoginBackground.GradientDay.Color = ColorSequence.new{
                ColorSequenceKeypoint.new(0, Color3.fromRGB(230, 230, 250)), -- Lavender
                ColorSequenceKeypoint.new(1, Color3.fromRGB(216, 191, 216))  -- Thistle
            }
        else
            -- Night gradient with lavender theme
            LoginBackground.GradientNight.Color = ColorSequence.new{
                ColorSequenceKeypoint.new(0, Color3.fromRGB(106, 90, 205)), -- Slate blue
                ColorSequenceKeypoint.new(1, Color3.fromRGB(147, 112, 219)) -- Medium purple
            }
        end
        
        -- State variables
        local IsDraggingWindow = false
        local IsDraggingMinimized = false
        local IsResizingSlider = false
        local IsMinimized = false
        local IsSmall = false
        local IsWhitelist = false
        local OriginalPosition
        local LastTouchInput
        
        -- Input handling
        local InputBeganConnection
        local InputChangedConnection
        local InputEndedConnection
        
        do
            local StartPosition = Vector2.zero
            local IsTouchInput = false
            local WindowStartPosition
            local MinimizedStartPosition
            local CurrentSlider
            local SliderValue
            
            InputBeganConnection = game:GetService("UserInputService").InputBegan:Connect(function(Input)
                if Input.UserInputType == Enum.UserInputType.MouseButton1 or Input.UserInputType == Enum.UserInputType.Touch then
                    if not IsTouchInput then
                        StartPosition = Input.Position
                        LastTouchInput = Input
                    end
                    
                    if IsDraggingWindow then
                        if Input.UserInputType == Enum.UserInputType.Touch then
                            IsTouchInput = true
                        end
                    end
                end
            end)
            
            InputChangedConnection = game:GetService("UserInputService").InputChanged:Connect(function(Input)
                if Input.UserInputType == Enum.UserInputType.MouseMovement or (Input.UserInputType == Enum.UserInputType.Touch and Input == LastTouchInput) then
                    if IsDraggingWindow then
                        ScreenContainer.Position = WindowStartPosition + UDim2.fromOffset(Input.Position.X - StartPosition.X, Input.Position.Y - StartPosition.Y)
                    elseif IsDraggingMinimized then
                        MinimizedTask.Position = MinimizedStartPosition + UDim2.fromOffset(Input.Position.X - StartPosition.X, Input.Position.Y - StartPosition.Y)
                        IsTouchInput = false
                    elseif IsResizingSlider then
                        local Slider = CurrentSlider.Parent
                        local StartPercent = (StartPosition.X - Slider.AbsolutePosition.X) / Slider.AbsoluteSize.X
                        local CurrentPercent = (Input.Position.X - Slider.AbsolutePosition.X) / Slider.AbsoluteSize.X
                        local NewPercent = math.clamp(SliderValue.X.Scale + (CurrentPercent - StartPercent), 0, 1)
                        local NewValue
                        
                        if SliderValue ~= math.huge and SliderValue ~= -math.huge then
                            local Range = (SliderValue.MaxValue - SliderValue.MinValue)
                            NewValue = math.round((SliderValue.MinValue + (NewPercent * Range)) * SliderValue) / SliderValue
                            local NewSize = UDim2.fromScale((NewValue - SliderValue.MinValue) / Range, 1)
                            CurrentSlider.Position = NewSize
                            SliderValue.Size = NewSize
                            NewValue = 1/NewValue ~= -math.huge and NewValue or 0
                        else
                            NewValue = SliderValue.MinValue + (NewPercent * (SliderValue.MaxValue - SliderValue.MinValue))
                            CurrentSlider.Position = UDim2.fromScale(NewPercent, 0.5)
                            SliderValue.Size = UDim2.fromScale(NewPercent, 1)
                        end
                        
                        NewValue = math.clamp(NewValue, SliderValue.MinValue, SliderValue.MaxValue)
                        TooltipLabel.Text = SliderValue.IsPercent and NewValue or math.round(100 * NewValue) .. "%"
                        
                        local TooltipSize = TooltipFrame.AbsoluteSize
                        TooltipContainer.Size = UDim2.fromOffset(TooltipSize.X, TooltipSize.Y)
                        
                        if SliderValue.Value ~= NewValue then
                            SliderValue.Value = NewValue
                            local OnChanged = SliderValue.OnChanged
                            OnChanged = type(OnChanged) == "function" and OnChanged or nil
                            if OnChanged then
                                coroutine.resume(coroutine.create(OnChanged), NewValue)
                            end
                        end
                    end
                end
            end)
            
            InputEndedConnection = game:GetService("UserInputService").InputEnded:Connect(function(Input)
                if Input.UserInputType == Enum.UserInputType.MouseButton1 or (Input.UserInputType == Enum.UserInputType.Touch and Input == LastTouchInput) then
                    IsDraggingWindow = false
                    IsDraggingMinimized = false
                    IsResizingSlider = false
                    
                    if CurrentSlider then
                        if CurrentTooltipTarget ~= CurrentSlider then
                            TooltipHideTween:Play()
                        end
                        CurrentSlider = nil
                        SliderValue = nil
                    end
                    
                    if Input == LastTouchInput then
                        IsTouchInput = false
                    end
                end
            end)
            
            -- Window dragging
            SurfaceGui.Window.Content.TopBar.WindowGrip.MouseButton1Down:Connect(function(Input)
                WindowStartPosition = ScreenContainer.Position
                IsDraggingWindow = true
            end)
            
            SurfaceGui.Window.Content.TopBar.WindowGrip.MouseButton1Up:Connect(function(Input)
                IsDraggingWindow = false
            end)
            
            -- Minimized window dragging
            local LogoClone = SurfaceGui.Window.Content.TopBar.LogoTitle.LogoContainer.Logo:Clone()
            LogoClone.Parent = MinimizedTask
            
            MinimizedTask.MouseButton1Down:Connect(function(Input)
                MinimizedStartPosition = MinimizedTask.Position
                IsDraggingMinimized = true
                IsTouchInput = true
            end)
            
            MinimizedTask.MouseButton1Up:Connect(function(Input)
                IsDraggingMinimized = false
                if IsTouchInput then
                    IsMinimized = false
                    MinimizedTask.Visible = false
                    ScreenContainer.Position = UDim2.fromOffset(
                        MinimizedTask.AbsolutePosition.X + MinimizedTask.AbsoluteSize.X/2,
                        MinimizedTask.AbsolutePosition.Y + MinimizedTask.AbsoluteSize.Y/2
                    )
                    TweenService:Create(ScreenContainer, TweenInfo.new(), {Position = OriginalPosition}):Play()
                    
                    local TweenToPlay
                    if IsSmall then
                        TweenToPlay = Resources.Tweens.GuiHalf
                    else
                        TweenToPlay = Resources.Tweens.GuiFull
                    end
                    TweenToPlay:Play()
                    Resources.Tweens.CanvasFull:Play()
                    
                    -- Window.IsMinimized = false
                    Resources.Bindables.MinimizedChanged:Fire(false)
                end
            end)
        end
        
        MinimizedTask.TouchTap:Connect(function()
            IsMinimized = false
            MinimizedTask.Visible = false
            ScreenContainer.Position = UDim2.fromOffset(
                MinimizedTask.AbsolutePosition.X + MinimizedTask.AbsoluteSize.X/2,
                MinimizedTask.AbsolutePosition.Y + MinimizedTask.AbsoluteSize.Y/2
            )
            TweenService:Create(ScreenContainer, TweenInfo.new(), {Position = OriginalPosition}):Play()
            
            if IsSmall then
                Resources.Tweens.GuiHalf:Play()
            else
                Resources.Tweens.GuiFull:Play()
            end
            Resources.Tweens.CanvasFull:Play()
            
            -- Window.IsMinimized = false
            Resources.Bindables.MinimizedChanged:Fire(false)
        end)
        
        -- Window controls
        SurfaceGui.Window.Content.TopBar.WindowControls.Maximize.MouseButton1Click:Connect(function()
            IsSmall = not IsSmall
            if IsSmall then
                Resources.Tweens.GuiHalf:Play()
            else
                Resources.Tweens.GuiFull:Play()
            end
            -- Window.IsSmall = IsSmall
            Resources.Bindables.SizeChanged:Fire(IsSmall)
        end)
        
        SurfaceGui.Window.Content.TopBar.WindowControls.Minimize.MouseButton1Click:Connect(function()
            IsMinimized = true
            OriginalPosition = ScreenContainer.Position
            local ExitTween = Resources.Tweens.GuiExit
            TweenService:Create(ScreenContainer, TweenInfo.new(), {
                Position = UDim2.fromOffset(
                    MinimizedTask.AbsolutePosition.X + MinimizedTask.AbsoluteSize.X/2,
                    MinimizedTask.AbsolutePosition.Y + MinimizedTask.AbsoluteSize.Y/2
                )
            }):Play()
            Resources.Tweens.CanvasMin:Play()
            ExitTween:Play()
            -- Window.IsMinimized = true
            Resources.Bindables.MinimizedChanged:Fire(true)
            ExitTween.Completed:Once(function()
                MinimizedTask.Visible = true
            end)
        end)
        
        SurfaceGui.Window.Content.TopBar.WindowControls.Close.MouseButton1Click:Connect(function()
            -- Window:ShowDialog({
            --     Title = "Close Cielberm?",
            --     Text = "This will close Cielberm, cleaning up everything. You won't be able to access it again unless you run it from your executor. Continue?",
            --     Buttons = {
            --         {Title = "OK", Callback = Window.Close, Secondary = true},
            --         {Title = "Cancel"}
            --     }
            -- })
        end)
        
        -- Login page buttons
        SurfaceGui.Window.Content.Login.LoginBox.CTAContainer.Help.MouseButton1Click:Connect(function()
            -- Window:ShowDialog({
            --     Title = "Need help?",
            --     Text = "If you are experiencing problems logging in, you may feel free to join our Discord server for support.",
            --     CopyBoxText = Config.DISCORD_INVITE
            -- })
        end)
        
        SurfaceGui.Window.Content.Login.LoginBox.CTAContainer.GetKey.MouseButton1Click:Connect(function()
            -- Window:ShowDialog({
            --     Title = "Get Key",
            --     Text = "To get a key for Cielberm, please visit the following URL below in your web browser. You will see ads which support us and help us to make more scripts. Thanks for your support!",
            --     CopyBoxText = IsWhitelist and Config.WHITELIST_LINK or Config.KEY_LINK
            -- })
        end)
        
        SurfaceGui.Window.Content.Login.LoginBox.LoginLayout.LogIn.MouseButton1Click:Connect(function()
            local OnLogin = --Login.OnLogin
            OnLogin = type(OnLogin) == "function" and OnLogin or nil
            local Key = not IsWhitelist and KeyInput.Text or nil
            if OnLogin then
                coroutine.resume(coroutine.create(OnLogin), Key)
            end
            Resources.Bindables.LoginRequest:Fire(Key)
        end)
        
        SurfaceGui.Window.Content.Login.DiscordButton.MouseButton1Click:Connect(function()
            -- Window:ShowDialog({
            --     Title = "Join our Discord server!",
            --     Text = "To recieve support, purchase keys, and chat with our community, feel free to join the server below!",
            --     CopyBoxText = Config.DISCORD_INVITE
            -- })
        end)
        
        -- Text input tracking
        local CurrentFocusedTextBox
        game:GetService("UserInputService").TextBoxFocused:Connect(function(TextBox)
            CurrentFocusedTextBox = TextBox
        end)
        
        game:GetService("UserInputService").TextBoxFocusReleased:Connect(function(TextBox)
            CurrentFocusedTextBox = nil
        end)
        
        -- Color picker implementation
        local CurrentColor = Color3.fromRGB(230, 230, 250) -- Lavender default
        local CurrentColorValue
        local Hue, Saturation, Value = CurrentColor:ToHSV()
        
        -- Color picker UI references
        local HuePad = AdvancedColors.AdvancedColors.ColorPads.ColorProf.Hue
        local ValueSlider = AdvancedColors.AdvancedColors.ColorPads.ValueProf.Light
        local ColorPreview = AdvancedColors.AdvancedColors.FineTuning.ColorPreview.Color
        local HueCursor = HuePad.Cursor
        local ValueArrow = ValueSlider.ArrowTrack.Arrow
        local FineTuneValues = AdvancedColors.AdvancedColors.FineTuning.FineTuneVals
        
        -- Text input tracking for color values
        local ColorInputValues = {
            [FineTuneValues.Hue.TextBox] = FineTuneValues.Hue.TextBox.Text,
            [FineTuneValues.Sat.TextBox] = FineTuneValues.Sat.TextBox.Text,
            [FineTuneValues.Val.TextBox] = FineTuneValues.Val.TextBox.Text,
            [FineTuneValues.R.TextBox] = FineTuneValues.R.TextBox.Text,
            [FineTuneValues.G.TextBox] = FineTuneValues.G.TextBox.Text,
            [FineTuneValues.B.TextBox] = FineTuneValues.B.TextBox.Text,
            [FineTuneValues.Hex.TextBox] = FineTuneValues.Hex.TextBox.Text
        }
        
        local ColorInputPositions = {
            [FineTuneValues.Hue.TextBox] = FineTuneValues.Hue.TextBox.CursorPosition,
            [FineTuneValues.Sat.TextBox] = FineTuneValues.Sat.TextBox.CursorPosition,
            [FineTuneValues.Val.TextBox] = FineTuneValues.Val.TextBox.CursorPosition,
            [FineTuneValues.R.TextBox] = FineTuneValues.R.TextBox.CursorPosition,
            [FineTuneValues.G.TextBox] = FineTuneValues.G.TextBox.CursorPosition,
            [FineTuneValues.B.TextBox] = FineTuneValues.B.TextBox.CursorPosition,
            [FineTuneValues.Hex.TextBox] = FineTuneValues.Hex.TextBox.CursorPosition
        }
        
        local ColorInputSelections = {
            [FineTuneValues.Hue.TextBox] = FineTuneValues.Hue.TextBox.SelectionStart,
            [FineTuneValues.Sat.TextBox] = FineTuneValues.Sat.TextBox.SelectionStart,
            [FineTuneValues.Val.TextBox] = FineTuneValues.Val.TextBox.SelectionStart,
            [FineTuneValues.R.TextBox] = FineTuneValues.R.TextBox.SelectionStart,
            [FineTuneValues.G.TextBox] = FineTuneValues.G.TextBox.SelectionStart,
            [FineTuneValues.B.TextBox] = FineTuneValues.B.TextBox.SelectionStart,
            [FineTuneValues.Hex.TextBox] = FineTuneValues.Hex.TextBox.SelectionStart
        }
        
        -- Hue pad interaction
        HuePad.Parent.InputBegan:Connect(function(Input)
            if Input.UserInputType == Enum.UserInputType.MouseButton1 or Input.UserInputType == Enum.UserInputType.Touch then
                local RelativePosition = ((Vector2.new(Input.Position.X, Input.Position.Y) - HuePad.AbsolutePosition) / HuePad.AbsoluteSize):Max(Vector2.zero):Min(Vector2.one)
                local NewHue = math.floor(RelativePosition.X * 359)
                local NewSaturation = math.floor(RelativePosition.Y * 255)
                
                Hue = (359 - NewHue) / 360
                Saturation = 1 - NewSaturation / 255
                CurrentColor = Color3.fromHSV(Hue, Saturation, Value)
                
                FineTuneValues.Hue.TextBox.Text = 359 - NewHue
                FineTuneValues.Sat.TextBox.Text = 255 - NewSaturation
                ColorInputValues[FineTuneValues.Hue.TextBox] = FineTuneValues.Hue.TextBox.Text
                ColorInputValues[FineTuneValues.Sat.TextBox] = FineTuneValues.Sat.TextBox.Text
                
                local HexColor = CurrentColor:ToHex()
                FineTuneValues.Hex.TextBox.Text = "#" .. HexColor
                FineTuneValues.R.TextBox.Text = tonumber(HexColor:sub(1, 2), 16)
                FineTuneValues.G.TextBox.Text = tonumber(HexColor:sub(3, 4), 16)
                FineTuneValues.B.TextBox.Text = tonumber(HexColor:sub(5, 6), 16)
                
                ColorInputValues[FineTuneValues.Hex.TextBox] = FineTuneValues.Hex.TextBox.Text
                ColorInputValues[FineTuneValues.R.TextBox] = FineTuneValues.R.TextBox.Text
                ColorInputValues[FineTuneValues.G.TextBox] = FineTuneValues.G.TextBox.Text
                ColorInputValues[FineTuneValues.B.TextBox] = FineTuneValues.B.TextBox.Text
                
                HueCursor.Position = UDim2.fromScale(NewHue / 359, NewSaturation / 255)
                ColorPreview.BackgroundColor3 = CurrentColor
                ValueSlider.BackgroundColor3 = Color3.fromHSV(Hue, Saturation, 1)
                IsResizingSlider = true
            end
        end)
        
        -- Value slider interaction
        ValueSlider.Parent.InputBegan:Connect(function(Input)
            if Input.UserInputType == Enum.UserInputType.MouseButton1 or Input.UserInputType == Enum.UserInputType.Touch then
                local NewValue = math.floor(math.clamp((Input.Position.Y - ValueSlider.AbsolutePosition.Y) / ValueSlider.AbsoluteSize.Y, 0, 1) * 255)
                Value = 1 - NewValue / 255
                CurrentColor = Color3.fromHSV(Hue, Saturation, Value)
                
                FineTuneValues.Val.TextBox.Text = 255 - NewValue
                ColorInputValues[FineTuneValues.Val.TextBox] = FineTuneValues.Val.TextBox.Text
                
                local HexColor = CurrentColor:ToHex()
                FineTuneValues.Hex.TextBox.Text = "#" .. HexColor
                FineTuneValues.R.TextBox.Text = tonumber(HexColor:sub(1, 2), 16)
                FineTuneValues.G.TextBox.Text = tonumber(HexColor:sub(3, 4), 16)
                FineTuneValues.B.TextBox.Text = tonumber(HexColor:sub(5, 6), 16)
                
                ColorInputValues[FineTuneValues.Hex.TextBox] = FineTuneValues.Hex.TextBox.Text
                ColorInputValues[FineTuneValues.R.TextBox] = FineTuneValues.R.TextBox.Text
                ColorInputValues[FineTuneValues.G.TextBox] = FineTuneValues.G.TextBox.Text
                ColorInputValues[FineTuneValues.B.TextBox] = FineTuneValues.B.TextBox.Text
                
                ValueArrow.Position = UDim2.fromScale(0, NewValue / 255)
                ColorPreview.BackgroundColor3 = CurrentColor
                CurrentColorValue = true
            end
        end)
        
        -- Hue pad input change handling
        HuePad.Parent.InputChanged:Connect(function(Input)
            if Input.UserInputType == Enum.UserInputType.MouseMovement or (Input.UserInputType == Enum.UserInputType.Touch and Input == LastTouchInput) then
                if IsResizingSlider then
                    local RelativePosition = ((Vector2.new(Input.Position.X, Input.Position.Y) - HuePad.AbsolutePosition) / HuePad.AbsoluteSize):Max(Vector2.zero):Min(Vector2.one)
                    local NewHue = math.floor(RelativePosition.X * 359)
                    local NewSaturation = math.floor(RelativePosition.Y * 255)
                    
                    Hue = (359 - NewHue) / 360
                    Saturation = 1 - NewSaturation / 255
                    CurrentColor = Color3.fromHSV(Hue, Saturation, Value)
                    
                    FineTuneValues.Hue.TextBox.Text = 359 - NewHue
                    FineTuneValues.Sat.TextBox.Text = 255 - NewSaturation
                    ColorInputValues[FineTuneValues.Hue.TextBox] = FineTuneValues.Hue.TextBox.Text
                    ColorInputValues[FineTuneValues.Sat.TextBox] = FineTuneValues.Sat.TextBox.Text
                    
                    local HexColor = CurrentColor:ToHex()
                    FineTuneValues.Hex.TextBox.Text = "#" .. HexColor
                    FineTuneValues.R.TextBox.Text = tonumber(HexColor:sub(1, 2), 16)
                    FineTuneValues.G.TextBox.Text = tonumber(HexColor:sub(3, 4), 16)
                    FineTuneValues.B.TextBox.Text = tonumber(HexColor:sub(5, 6), 16)
                    
                    ColorInputValues[FineTuneValues.Hex.TextBox] = FineTuneValues.Hex.TextBox.Text
                    ColorInputValues[FineTuneValues.R.TextBox] = FineTuneValues.R.TextBox.Text
                    ColorInputValues[FineTuneValues.G.TextBox] = FineTuneValues.G.TextBox.Text
                    ColorInputValues[FineTuneValues.B.TextBox] = FineTuneValues.B.TextBox.Text
                    
                    HueCursor.Position = UDim2.fromScale(NewHue / 359, NewSaturation / 255)
                    ColorPreview.BackgroundColor3 = CurrentColor
                    ValueSlider.BackgroundColor3 = Color3.fromHSV(Hue, Saturation, 1)
                end
            end
        end)
        
        -- Value slider input change handling
        ValueSlider.Parent.InputChanged:Connect(function(Input)
            if Input.UserInputType == Enum.UserInputType.MouseMovement or (Input.UserInputType == Enum.UserInputType.Touch and Input == LastTouchInput) then
                if CurrentColorValue then
                    local NewValue = math.floor(math.clamp((Input.Position.Y - ValueSlider.AbsolutePosition.Y) / ValueSlider.AbsoluteSize.Y, 0, 1) * 255)
                    Value = 1 - NewValue / 255
                    CurrentColor = Color3.fromHSV(Hue, Saturation, Value)
                    
                    FineTuneValues.Val.TextBox.Text = 255 - NewValue
                    ColorInputValues[FineTuneValues.Val.TextBox] = FineTuneValues.Val.TextBox.Text
                    
                    local HexColor = CurrentColor:ToHex()
                    FineTuneValues.Hex.TextBox.Text = "#" .. HexColor
                    FineTuneValues.R.TextBox.Text = tonumber(HexColor:sub(1, 2), 16)
                    FineTuneValues.G.TextBox.Text = tonumber(HexColor:sub(3, 4), 16)
                    FineTuneValues.B.TextBox.Text = tonumber(HexColor:sub(5, 6), 16)
                    
                    ColorInputValues[FineTuneValues.Hex.TextBox] = FineTuneValues.Hex.TextBox.Text
                    ColorInputValues[FineTuneValues.R.TextBox] = FineTuneValues.R.TextBox.Text
                    ColorInputValues[FineTuneValues.G.TextBox] = FineTuneValues.G.TextBox.Text
                    ColorInputValues[FineTuneValues.B.TextBox] = FineTuneValues.B.TextBox.Text
                    
                    ValueArrow.Position = UDim2.fromScale(0, NewValue / 255)
                    ColorPreview.BackgroundColor3 = CurrentColor
                end
            end
        end)
        
        -- Text input handling for color values
        for TextBox, _ in pairs(ColorInputValues) do
            if TextBox == FineTuneValues.Hue.TextBox then
                FineTuneValues.Hue.TextBox:GetPropertyChangedSignal("CursorPosition"):Connect(function()
                    local Text = FineTuneValues.Hue.TextBox.Text
                    if Text == "" or not Text:match("%D") and tonumber(Text) < 359 then
                        ColorInputPositions[FineTuneValues.Hue.TextBox] = FineTuneValues.Hue.TextBox.CursorPosition
                    end
                end)
                
                FineTuneValues.Hue.TextBox:GetPropertyChangedSignal("SelectionStart"):Connect(function()
                    local Text = FineTuneValues.Hue.TextBox.Text
                    if Text == "" or not Text:match("%D") and tonumber(Text) < 359 then
                        ColorInputSelections[FineTuneValues.Hue.TextBox] = FineTuneValues.Hue.TextBox.SelectionStart
                    end
                end)
            elseif TextBox ~= FineTuneValues.Hex.TextBox then
                FineTuneValues.Hex.TextBox:GetPropertyChangedSignal("CursorPosition"):Connect(function()
                    local Text = FineTuneValues.Hex.TextBox.Text
                    if Text == "" or string.sub(Text, 1, 1) == "#" and not string.sub(Text, 2):match("%X") and #Text < 8 then
                        ColorInputPositions[FineTuneValues.Hex.TextBox] = FineTuneValues.Hex.TextBox.CursorPosition
                    end
                end)
                
                FineTuneValues.Hex.TextBox:GetPropertyChangedSignal("SelectionStart"):Connect(function()
                    local Text = FineTuneValues.Hex.TextBox.Text
                    if Text == "" or string.sub(Text, 1, 1) == "#" and not string.sub(Text, 2):match("%X") and #Text < 8 then
                        ColorInputSelections[FineTuneValues.Hex.TextBox] = FineTuneValues.Hex.TextBox.SelectionStart
                    end
                end)
            else
                TextBox:GetPropertyChangedSignal("CursorPosition"):Connect(function()
                    local Text = TextBox.Text
                    if Text == "" or not Text:match("%D") and tonumber(Text) < 256 then
                        ColorInputPositions[TextBox] = TextBox.CursorPosition
                    end
                end)
                
                TextBox:GetPropertyChangedSignal("SelectionStart"):Connect(function()
                    local Text = TextBox.Text
                    if Text == "" or not Text:match("%D") and tonumber(Text) < 256 then
                        ColorInputSelections[TextBox] = TextBox.SelectionStart
                    end
                end)
            end
        end
        
        -- Text change handling for color values
        for TextBox, _ in pairs(ColorInputValues) do
            if TextBox == FineTuneValues.Hue.TextBox then
                TextBox:GetPropertyChangedSignal("Text"):Connect(function()
                    if CurrentFocusedTextBox == TextBox then
                        local Text = TextBox.Text
                        if Text == "" or not Text:match("%D") and tonumber(Text) < 360 then
                            ColorInputValues[TextBox] = Text
                            if Text ~= "" then
                                Hue = tonumber(Text) / 360
                                local HexColor = Color3.fromHSV(Hue, Saturation, Value):ToHex()
                                CurrentColor = Color3.fromHex(HexColor)
                                
                                FineTuneValues.Hex.TextBox.Text = "#" .. HexColor
                                FineTuneValues.R.TextBox.Text = tonumber(HexColor:sub(1, 2), 16)
                                FineTuneValues.G.TextBox.Text = tonumber(HexColor:sub(3, 4), 16)
                                FineTuneValues.B.TextBox.Text = tonumber(HexColor:sub(5, 6), 16)
                                
                                ColorInputValues[FineTuneValues.Hex.TextBox] = FineTuneValues.Hex.TextBox.Text
                                ColorInputValues[FineTuneValues.R.TextBox] = FineTuneValues.R.TextBox.Text
                                ColorInputValues[FineTuneValues.G.TextBox] = FineTuneValues.G.TextBox.Text
                                ColorInputValues[FineTuneValues.B.TextBox] = FineTuneValues.B.TextBox.Text
                                
                                HueCursor.Position = UDim2.fromScale(1 - tonumber(Text) / 359, 1 - Saturation)
                                ColorPreview.BackgroundColor3 = CurrentColor
                                ValueSlider.BackgroundColor3 = Color3.fromHSV(Hue, Saturation, 1)
                            end
                        else
                            TextBox.Text = ColorInputValues[TextBox]
                            TextBox.CursorPosition = ColorInputPositions[TextBox]
                            TextBox.SelectionStart = ColorInputSelections[TextBox]
                        end
                    end
                end)
            elseif TextBox == FineTuneValues.Sat.TextBox then
                TextBox:GetPropertyChangedSignal("Text"):Connect(function()
                    if CurrentFocusedTextBox == TextBox then
                        local Text = TextBox.Text
                        if Text == "" or not Text:match("%D") and tonumber(Text) < 256 then
                            ColorInputValues[TextBox] = Text
                            if Text ~= "" then
                                Saturation = tonumber(Text) / 255
                                local HexColor = Color3.fromHSV(Hue, Saturation, Value):ToHex()
                                CurrentColor = Color3.fromHex(HexColor)
                                
                                FineTuneValues.Hex.TextBox.Text = "#" .. HexColor
                                FineTuneValues.R.TextBox.Text = tonumber(HexColor:sub(1, 2), 16)
                                FineTuneValues.G.TextBox.Text = tonumber(HexColor:sub(3, 4), 16)
                                FineTuneValues.B.TextBox.Text = tonumber(HexColor:sub(5, 6), 16)
                                
                                ColorInputValues[FineTuneValues.Hex.TextBox] = FineTuneValues.Hex.TextBox.Text
                                ColorInputValues[FineTuneValues.R.TextBox] = FineTuneValues.R.TextBox.Text
                                ColorInputValues[FineTuneValues.G.TextBox] = FineTuneValues.G.TextBox.Text
                                ColorInputValues[FineTuneValues.B.TextBox] = FineTuneValues.B.TextBox.Text
                                
                                HueCursor.Position = UDim2.fromScale(1 - Hue, 1 - Saturation)
                                ColorPreview.BackgroundColor3 = CurrentColor
                                ValueSlider.BackgroundColor3 = Color3.fromHSV(Hue, Saturation, 1)
                            end
                        else
                            TextBox.Text = ColorInputValues[TextBox]
                            TextBox.CursorPosition = ColorInputPositions[TextBox]
                            TextBox.SelectionStart = ColorInputSelections[TextBox]
                        end
                    end
                end)
            elseif TextBox == FineTuneValues.Val.TextBox then
                TextBox:GetPropertyChangedSignal("Text"):Connect(function()
                    if CurrentFocusedTextBox == TextBox then
                        local Text = TextBox.Text
                        if Text == "" or not Text:match("%D") and tonumber(Text) < 256 then
                            ColorInputValues[TextBox] = Text
                            if Text ~= "" then
                                Value = tonumber(Text) / 255
                                local HexColor = Color3.fromHSV(Hue, Saturation, Value):ToHex()
                                CurrentColor = Color3.fromHex(HexColor)
                                
                                FineTuneValues.Hex.TextBox.Text = "#" .. HexColor
                                FineTuneValues.R.TextBox.Text = tonumber(HexColor:sub(1, 2), 16)
                                FineTuneValues.G.TextBox.Text = tonumber(HexColor:sub(3, 4), 16)
                                FineTuneValues.B.TextBox.Text = tonumber(HexColor:sub(5, 6), 16)
                                
                                ColorInputValues[FineTuneValues.Hex.TextBox] = FineTuneValues.Hex.TextBox.Text
                                ColorInputValues[FineTuneValues.R.TextBox] = FineTuneValues.R.TextBox.Text
                                ColorInputValues[FineTuneValues.G.TextBox] = FineTuneValues.G.TextBox.Text
                                ColorInputValues[FineTuneValues.B.TextBox] = FineTuneValues.B.TextBox.Text
                                
                                ValueArrow.Position = UDim2.fromScale(0, 1 - Value)
                                ColorPreview.BackgroundColor3 = CurrentColor
                            end
                        else
                            TextBox.Text = ColorInputValues[TextBox]
                            TextBox.CursorPosition = ColorInputPositions[TextBox]
                            TextBox.SelectionStart = ColorInputSelections[TextBox]
                        end
                    end
                end)
            elseif TextBox == FineTuneValues.R.TextBox then
                TextBox:GetPropertyChangedSignal("Text"):Connect(function()
                    if CurrentFocusedTextBox == TextBox then
                        local Text = TextBox.Text
                        if Text == "" or not Text:match("%D") and tonumber(Text) < 256 then
                            ColorInputValues[TextBox] = Text
                            if Text ~= "" then
                                local RedValue = tonumber(Text)
                                CurrentColor = Color3.new(RedValue / 255, CurrentColor.G, CurrentColor.B)
                                
                                local Red, Green, Blue = RedValue, math.floor(CurrentColor.G * 255), math.floor(CurrentColor.B * 255)
                                local MaxValue, MinValue = math.max(Red, Green, Blue), math.min(Red, Green, Blue)
                                
                                local NewHue, NewSaturation, NewValue
                                NewValue = MaxValue
                                local Delta = MaxValue - MinValue
                                
                                if MaxValue == 0 then
                                    NewSaturation = 0
                                else
                                    NewSaturation = (Delta * 255) / MaxValue
                                end
                                
                                if MaxValue == MinValue then
                                    NewHue = 0
                                else
                                    if MaxValue == Red then
                                        NewHue = ((Green - Blue) * 60) / Delta
                                        if Green < Blue then
                                            NewHue = NewHue + 360
                                        end
                                    elseif MaxValue == Green then
                                        NewHue = ((Blue - Red) * 60) / Delta + 120
                                    elseif MaxValue == Blue then
                                        NewHue = ((Red - Green) * 60) / Delta + 240
                                    end
                                end
                                
                                Hue, Saturation, Value = NewHue / 360, NewSaturation / 255, NewValue / 255
                                
                                local HexColor = CurrentColor:ToHex()
                                FineTuneValues.Hex.TextBox.Text = "#" .. HexColor
                                FineTuneValues.Hue.TextBox.Text = math.floor(NewHue)
                                FineTuneValues.Sat.TextBox.Text = math.round(NewSaturation)
                                FineTuneValues.Val.TextBox.Text = math.round(NewValue)
                                
                                ColorInputValues[FineTuneValues.Hex.TextBox] = FineTuneValues.Hex.TextBox.Text
                                ColorInputValues[FineTuneValues.Hue.TextBox] = FineTuneValues.Hue.TextBox.Text
                                ColorInputValues[FineTuneValues.Sat.TextBox] = FineTuneValues.Sat.TextBox.Text
                                ColorInputValues[FineTuneValues.Val.TextBox] = FineTuneValues.Val.TextBox.Text
                                
                                HueCursor.Position = UDim2.fromScale(1 - NewHue / 359, 1 - NewSaturation)
                                ValueArrow.Position = UDim2.fromScale(0, 1 - NewValue)
                                ColorPreview.BackgroundColor3 = CurrentColor
                                ValueSlider.BackgroundColor3 = Color3.fromHSV(Hue, Saturation, 1)
                            end
                        else
                            TextBox.Text = ColorInputValues[TextBox]
                            TextBox.CursorPosition = ColorInputPositions[TextBox]
                            TextBox.SelectionStart = ColorInputSelections[TextBox]
                        end
                    end
                end)
            elseif TextBox == FineTuneValues.G.TextBox then
                TextBox:GetPropertyChangedSignal("Text"):Connect(function()
                    if CurrentFocusedTextBox == TextBox then
                        local Text = TextBox.Text
                        if Text == "" or not Text:match("%D") and tonumber(Text) < 256 then
                            ColorInputValues[TextBox] = Text
                            if Text ~= "" then
                                local GreenValue = tonumber(Text)
                                CurrentColor = Color3.new(CurrentColor.R, GreenValue / 255, CurrentColor.B)
                                
                                local Red, Green, Blue = math.floor(CurrentColor.R * 255), GreenValue, math.floor(CurrentColor.B * 255)
                                local MaxValue, MinValue = math.max(Red, Green, Blue), math.min(Red, Green, Blue)
                                
                                local NewHue, NewSaturation, NewValue
                                NewValue = MaxValue
                                local Delta = MaxValue - MinValue
                                
                                if MaxValue == 0 then
                                    NewSaturation = 0
                                else
                                    NewSaturation = (Delta * 255) / MaxValue
                                end
                                
                                if MaxValue == MinValue then
                                    NewHue = 0
                                else
                                    if MaxValue == Red then
                                        NewHue = ((Green - Blue) * 60) / Delta
                                        if Green < Blue then
                                            NewHue = NewHue + 360
                                        end
                                    elseif MaxValue == Green then
                                        NewHue = ((Blue - Red) * 60) / Delta + 120
                                    elseif MaxValue == Blue then
                                        NewHue = ((Red - Green) * 60) / Delta + 240
                                    end
                                end
                                
                                Hue, Saturation, Value = NewHue / 360, NewSaturation / 255, NewValue / 255
                                
                                local HexColor = CurrentColor:ToHex()
                                FineTuneValues.Hex.TextBox.Text = "#" .. HexColor
                                FineTuneValues.Hue.TextBox.Text = math.floor(NewHue)
                                FineTuneValues.Sat.TextBox.Text = math.round(NewSaturation)
                                FineTuneValues.Val.TextBox.Text = math.round(NewValue)
                                
                                ColorInputValues[FineTuneValues.Hex.TextBox] = FineTuneValues.Hex.TextBox.Text
                                ColorInputValues[FineTuneValues.Hue.TextBox] = FineTuneValues.Hue.TextBox.Text
                                ColorInputValues[FineTuneValues.Sat.TextBox] = FineTuneValues.Sat.TextBox.Text
                                ColorInputValues[FineTuneValues.Val.TextBox] = FineTuneValues.Val.TextBox.Text
                                
                                HueCursor.Position = UDim2.fromScale(1 - NewHue / 359, 1 - NewSaturation)
                                ValueArrow.Position = UDim2.fromScale(0, 1 - NewValue)
                                ColorPreview.BackgroundColor3 = CurrentColor
                                ValueSlider.BackgroundColor3 = Color3.fromHSV(Hue, Saturation, 1)
                            end
                        else
                            TextBox.Text = ColorInputValues[TextBox]
                            TextBox.CursorPosition = ColorInputPositions[TextBox]
                            TextBox.SelectionStart = ColorInputSelections[TextBox]
                        end
                    end
                end)
            elseif TextBox == FineTuneValues.B.TextBox then
                TextBox:GetPropertyChangedSignal("Text"):Connect(function()
                    if CurrentFocusedTextBox == TextBox then
                        local Text = TextBox.Text
                        if Text == "" or not Text:match("%D") and tonumber(Text) < 256 then
                            ColorInputValues[TextBox] = Text
                            if Text ~= "" then
                                local BlueValue = tonumber(Text)
                                CurrentColor = Color3.new(CurrentColor.R, CurrentColor.G, BlueValue / 255)
                                
                                local Red, Green, Blue = math.floor(CurrentColor.R * 255), math.floor(CurrentColor.G * 255), BlueValue
                                local MaxValue, MinValue = math.max(Red, Green, Blue), math.min(Red, Green, Blue)
                                
                                local NewHue, NewSaturation, NewValue
                                NewValue = MaxValue
                                local Delta = MaxValue - MinValue
                                
                                if MaxValue == 0 then
                                    NewSaturation = 0
                                else
                                    NewSaturation = (Delta * 255) / MaxValue
                                end
                                
                                if MaxValue == MinValue then
                                    NewHue = 0
                                else
                                    if MaxValue == Red then
                                        NewHue = ((Green - Blue) * 60) / Delta
                                        if Green < Blue then
                                            NewHue = NewHue + 360
                                        end
                                    elseif MaxValue == Green then
                                        NewHue = ((Blue - Red) * 60) / Delta + 120
                                    elseif MaxValue == Blue then
                                        NewHue = ((Red - Green) * 60) / Delta + 240
                                    end
                                end
                                
                                Hue, Saturation, Value = NewHue / 360, NewSaturation / 255, NewValue / 255
                                
                                local HexColor = CurrentColor:ToHex()
                                FineTuneValues.Hex.TextBox.Text = "#" .. HexColor
                                FineTuneValues.Hue.TextBox.Text = math.floor(NewHue)
                                FineTuneValues.Sat.TextBox.Text = math.round(NewSaturation)
                                FineTuneValues.Val.TextBox.Text = math.round(NewValue)
                                
                                ColorInputValues[FineTuneValues.Hex.TextBox] = FineTuneValues.Hex.TextBox.Text
                                ColorInputValues[FineTuneValues.Hue.TextBox] = FineTuneValues.Hue.TextBox.Text
                                ColorInputValues[FineTuneValues.Sat.TextBox] = FineTuneValues.Sat.TextBox.Text
                                ColorInputValues[FineTuneValues.Val.TextBox] = FineTuneValues.Val.TextBox.Text
                                
                                HueCursor.Position = UDim2.fromScale(1 - NewHue / 359, 1 - NewSaturation)
                                ValueArrow.Position = UDim2.fromScale(0, 1 - NewValue)
                                ColorPreview.BackgroundColor3 = CurrentColor
                                ValueSlider.BackgroundColor3 = Color3.fromHSV(Hue, Saturation, 1)
                            end
                        else
                            TextBox.Text = ColorInputValues[TextBox]
                            TextBox.CursorPosition = ColorInputPositions[TextBox]
                            TextBox.SelectionStart = ColorInputSelections[TextBox]
                        end
                    end
                end)
            elseif TextBox == FineTuneValues.Hex.TextBox then
                FineTuneValues.Hex.TextBox:GetPropertyChangedSignal("Text"):Connect(function()
                    if CurrentFocusedTextBox == TextBox then
                        local Text = FineTuneValues.Hex.TextBox.Text
                        if Text == "" or string.sub(Text, 1, 1) == "#" and not string.sub(Text, 2):match("%X") and #Text < 8 then
                            ColorInputValues[FineTuneValues.Hex.TextBox] = Text
                            local Success, Color = pcall(Color3.fromHex, Text)
                            if Success then
                                CurrentColor = Color
                                local Red, Green, Blue = math.floor(CurrentColor.R * 255), math.floor(CurrentColor.G * 255), math.floor(CurrentColor.B * 255)
                                local MaxValue, MinValue = math.max(Red, Green, Blue), math.min(Red, Green, Blue)
                                
                                local NewHue, NewSaturation, NewValue
                                NewValue = MaxValue
                                local Delta = MaxValue - MinValue
                                
                                if MaxValue == 0 then
                                    NewSaturation = 0
                                else
                                    NewSaturation = (Delta * 255) / MaxValue
                                end
                                
                                if MaxValue == MinValue then
                                    NewHue = 0
                                else
                                    if MaxValue == Red then
                                        NewHue = ((Green - Blue) * 60) / Delta
                                        if Green < Blue then
                                            NewHue = NewHue + 360
                                        end
                                    elseif MaxValue == Green then
                                        NewHue = ((Blue - Red) * 60) / Delta + 120
                                    elseif MaxValue == Blue then
                                        NewHue = ((Red - Green) * 60) / Delta + 240
                                    end
                                end
                                
                                Hue, Saturation, Value = NewHue / 360, NewSaturation / 255, NewValue / 255
                                
                                FineTuneValues.R.TextBox.Text = Red
                                FineTuneValues.G.TextBox.Text = Green
                                FineTuneValues.B.TextBox.Text = Blue
                                FineTuneValues.Hue.TextBox.Text = math.floor(NewHue)
                                FineTuneValues.Sat.TextBox.Text = math.round(NewSaturation)
                                FineTuneValues.Val.TextBox.Text = math.round(NewValue)
                                
                                ColorInputValues[FineTuneValues.R.TextBox] = FineTuneValues.R.TextBox.Text
                                ColorInputValues[FineTuneValues.G.TextBox] = FineTuneValues.G.TextBox.Text
                                ColorInputValues[FineTuneValues.B.TextBox] = FineTuneValues.B.TextBox.Text
                                ColorInputValues[FineTuneValues.Hue.TextBox] = FineTuneValues.Hue.TextBox.Text
                                ColorInputValues[FineTuneValues.Sat.TextBox] = FineTuneValues.Sat.TextBox.Text
                                ColorInputValues[FineTuneValues.Val.TextBox] = FineTuneValues.Val.TextBox.Text
                                
                                HueCursor.Position = UDim2.fromScale(1 - NewHue / 359, 1 - NewSaturation)
                                ValueArrow.Position = UDim2.fromScale(0, 1 - NewValue)
                                ColorPreview.BackgroundColor3 = CurrentColor
                                ValueSlider.BackgroundColor3 = Color3.fromHSV(Hue, Saturation, 1)
                            end
                        else
                            FineTuneValues.Hex.TextBox.Text = ColorInputValues[FineTuneValues.Hex.TextBox]
                        end
                    end
                end)
            end
        end
        
        -- Basic color grid with lavender theme
        local ColorSwatch = Resources.Components.ColorSwatch
        local BasicColorGrid = BasicColors.BasicColorGrid
        
        for Row = 0, 3 do
            for Column = 0, 3 do
                for Value = 0, 2 do
                    local Swatch = ColorSwatch:Clone()
                    -- Create lavender-based colors
                    local BaseLavender = Color3.fromRGB(230, 230, 250)
                    local SwatchColor = Color3.new(
                        BaseLavender.R * (1 - Column/4),
                        BaseLavender.G * (1 - Row/4),
                        BaseLavender.B * (1 - Value/3)
                    )
                    local HexColor = "#" .. SwatchColor:ToHex()
                    
                    Swatch.ColorButton.BackgroundColor3 = SwatchColor
                    Swatch.LayoutOrder = Row * 12 + Column * 3 + Value
                    Swatch.Parent = BasicColorGrid
                    
                    Swatch.ColorButton.MouseButton1Click:Connect(function()
                        BasicColors.Visible = false
                        AdvancedColors.Visible = true
                        ColorPickerTitle.Text = "Advanced Colors"
                        CurrentColor = SwatchColor
                        
                        local Red, Green, Blue = math.floor(CurrentColor.R * 255), math.floor(CurrentColor.G * 255), math.floor(CurrentColor.B * 255)
                        local MaxValue, MinValue = math.max(Red, Green, Blue), math.min(Red, Green, Blue)
                        
                        local NewHue, NewSaturation, NewValue
                        NewValue = MaxValue
                        local Delta = MaxValue - MinValue
                        
                        if MaxValue == 0 then
                            NewSaturation = 0
                        else
                            NewSaturation = (Delta * 255) / MaxValue
                        end
                        
                        if MaxValue == MinValue then
                            NewHue = 0
                        else
                            if MaxValue == Red then
                                NewHue = ((Green - Blue) * 60) / Delta
                                if Green < Blue then
                                    NewHue = NewHue + 360
                                end
                            elseif MaxValue == Green then
                                NewHue = ((Blue - Red) * 60) / Delta + 120
                            elseif MaxValue == Blue then
                                NewHue = ((Red - Green) * 60) / Delta + 240
                            end
                        end
                        
                        Hue, Saturation, Value = NewHue / 360, NewSaturation / 255, NewValue / 255
                        
                        FineTuneValues.Hue.TextBox.Text = math.floor(NewHue)
                        FineTuneValues.Sat.TextBox.Text = math.round(NewSaturation)
                        FineTuneValues.Val.TextBox.Text = math.round(NewValue)
                        
                        ColorInputValues[FineTuneValues.Hue.TextBox] = FineTuneValues.Hue.TextBox.Text
                        ColorInputValues[FineTuneValues.Sat.TextBox] = FineTuneValues.Sat.TextBox.Text
                        ColorInputValues[FineTuneValues.Val.TextBox] = FineTuneValues.Val.TextBox.Text
                        
                        FineTuneValues.Hex.TextBox.Text = HexColor
                        FineTuneValues.R.TextBox.Text = math.floor(SwatchColor.R * 255)
                        FineTuneValues.G.TextBox.Text = math.floor(SwatchColor.G * 255)
                        FineTuneValues.B.TextBox.Text = math.floor(SwatchColor.B * 255)
                        
                        ColorInputValues[FineTuneValues.Hex.TextBox] = FineTuneValues.Hex.TextBox.Text
                        ColorInputValues[FineTuneValues.R.TextBox] = FineTuneValues.R.TextBox.Text
                        ColorInputValues[FineTuneValues.G.TextBox] = FineTuneValues.G.TextBox.Text
                        ColorInputValues[FineTuneValues.B.TextBox] = FineTuneValues.B.TextBox.Text
                        
                        HueCursor.Position = UDim2.fromScale(1 - Hue, 1 - Saturation)
                        ValueArrow.Position = UDim2.fromScale(0, 1 - Value)
                        ColorPreview.BackgroundColor3 = CurrentColor
                        ValueSlider.BackgroundColor3 = Color3.fromHSV(Hue, Saturation, 1)
                        
                        Resources.Tweens.AdvancedColorsEnter:Play()
                    end)
                end
            end
        end
        
        -- Color picker footer buttons
        BasicColors.FooterButton.MouseButton1Click:Connect(function()
            BasicColors.Visible = false
            AdvancedColors.Visible = true
            ColorPickerTitle.Text = "Advanced Colors"
            Resources.Tweens.AdvancedColorsEnter:Play()
        end)
        
        AdvancedColors.FooterButton.MouseButton1Click:Connect(function()
            AdvancedColors.Visible = false
            BasicColors.Visible = true
            ColorPickerTitle.Text = "Basic Colors"
            Resources.Tweens.AdvancedColorsExit:Play()
        end)
        
        -- Color picker close buttons
        for _, Button in pairs({ColorPickerUI.TopBar.Close, AdvancedColors.AdvancedColors.FineTuning.Buttons.Cancel}) do
            Button.MouseButton1Click:Connect(function()
                Resources.Tweens.ColorPickerClose:Play()
                Resources.Tweens.ColorModalShadeFadeOut:Play()
                TooltipCount = TooltipCount - 1
                if TooltipCount == 0 then
                    SurfaceGui.Window.Content.Interactable = true
                end
            end)
        end
        
        -- Color picker OK button
        local ColorPickerTarget
        AdvancedColors.AdvancedColors.FineTuning.Buttons.OK.MouseButton1Click:Connect(function()
            ColorPickerTarget.BackgroundColor3 = CurrentColor
            Resources.Tweens.ColorPickerClose:Play()
            Resources.Tweens.ColorModalShadeFadeOut:Play()
            TooltipCount = TooltipCount - 1
            if TooltipCount == 0 then
                SurfaceGui.Window.Content.Interactable = true
            end
            CurrentColorValue.Value = CurrentColor
            local OnChanged = CurrentColorValue.OnChanged
            OnChanged = type(OnChanged) == "function" and OnChanged or nil
            if OnChanged then
                coroutine.resume(coroutine.create(OnChanged), CurrentColor, 0)
            end
        end)
        
        -- Login page icons
        do
            local Icons = Resources.Icons["20px"]
            local CTAContainer = LoginWindow.Parent.Parent.CTAContainer
            
            Icons.meridians:Clone().Parent = CTAContainer.GetKey.IconContainer
            Icons.help:Clone().Parent = CTAContainer.Help.IconContainer
            Icons["lock-open"]:Clone().Parent = LoginWindow.Parent.LogIn
            Icons.key:Clone().Parent = LoginWindow.KeyIcon
        end
        
        -- Login tips carousel with Cielberm theme
        do
            local IsFirstTip = true
            local LoginTips = Resources.Icons.LoginTips
            local TipPage = Resources.Components.LoginTipPage
            local PageIndicator = Resources.Components.PageIndicator
            local TipScroller = SurfaceGui.Window.Content.Login.TipScroller
            local InnerContent = TipScroller.InnerContent
            local PageLayout = InnerContent.UIPageLayout
            local PageProgress = TipScroller.PageProgress
            local ProgressBar = TipScroller.ProgressBar.ProgressValue
            
            for _, TipData in pairs({
                {"Cielberm Beta", "Support us by testing out beta features before they are released to everyone.", LoginTips.Beta, Color3.fromRGB(230, 230, 250)},
                {"Join our Discord!", "Stay updated with news, new games, and interact with our friendly community.", LoginTips.DiscordClyde, Color3.fromRGB(216, 191, 216)},
                {"Get Keyless", "Tired of the key system? With Keyless, you get a permanent key that works forever. Never see an ad again.", LoginTips.DemonKey, Color3.fromRGB(147, 112, 219)}
            }) do
                local Tip = TipPage:Clone()
                local Details = Tip.Details
                local Icon = Tip.Icon
                
                Details.Title.Text = TipData[1]
                Details.Desc.Text = TipData[2]
                Icon.BackgroundColor3 = TipData[4]
                TipData[3]:Clone().Parent = Icon
                
                Tip.Parent = InnerContent
                
                local Indicator = PageIndicator:Clone()
                local Bubble = Indicator.Bubble
                Indicator.Parent = PageProgress
                
                if IsFirstTip then
                    IsFirstTip = false
                    Bubble.BackgroundTransparency = 0
                end
                
                for EventType, Tween in next, {
                    [PageLayout.PageEnter] = TweenService:Create(Bubble, TweenInfo.new(), {BackgroundTransparency = 0}),
                    [PageLayout.PageLeave] = TweenService:Create(Bubble, TweenInfo.new(), {BackgroundTransparency = 1})
                } do
                    Tween:Connect(function(CurrentPage)
                        if CurrentPage == Tip then
                            Tween:Play()
                        end
                    end)
                end
            end
            
            local CurrentPageIndex = 1
            local ProgressTween = TweenService:Create(ProgressBar, TweenInfo.new(10, Enum.EasingStyle.Linear), {Size = UDim2.fromScale(1, 2)})
            
            local function NextTip()
                ProgressBar.Size = UDim2.fromScale(0, 2)
                ProgressTween:Play()
                PageLayout:JumpToIndex(CurrentPageIndex)
                
                if CurrentPageIndex == 3 then
                    CurrentPageIndex = 1
                else
                    CurrentPageIndex = CurrentPageIndex + 1
                end
            end
            
            ProgressTween.Completed:Connect(NextTip)
            ProgressTween:Play()
            
            LoginTips.DiscordClyde:Clone().Parent = SurfaceGui.Window.Content.Login.DiscordButton
        end
        
        -- Tooltip positioning
        local function PositionTooltip(Position, Size, Direction)
            local AnchorPoint, TailAnchor
            local TailPosition, TailSize
            
            if Direction == 1 then -- Top
                AnchorPoint, TailAnchor = Vector2.new(0.5), Vector2.new(0.5, 1)
                TooltipLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
                TooltipLayout.VerticalAlignment = Enum.VerticalAlignment.Top
                TailContainer.Position = UDim2.fromScale(0.5)
                TailContainer.Size = UDim2.fromOffset(8, 7)
                TailLeftClip.Position = UDim2.fromOffset()
                TailLeftClip.AnchorPoint = Vector2.zero
                TailLeftClip.Size = UDim2.fromOffset(4, 7)
                TailRightClip.Position = UDim2.fromScale(1)
                TailRightClip.AnchorPoint = Vector2.xAxis
                TailRightClip.Size = UDim2.fromOffset(4, 7)
                TailLeft.Position = UDim2.new(0, 1, 1)
                TailLeft.AnchorPoint = Vector2.new(0, 0.5)
                TailRight.Position = UDim2.new(1, -1, 1)
                TailRight.AnchorPoint = Vector2.new(1, 0.5)
            elseif Direction == 2 then -- Left
                AnchorPoint, TailAnchor = Vector2.new(0, 0.5), Vector2.new(1, 0.5)
                TooltipLayout.HorizontalAlignment = Enum.HorizontalAlignment.Left
                TooltipLayout.VerticalAlignment = Enum.VerticalAlignment.Center
                TailContainer.Position = UDim2.new(0, -4, 0.5)
                TailContainer.Size = UDim2.fromOffset(7, 8)
                TailLeftClip.Position = UDim2.fromOffset()
                TailLeftClip.AnchorPoint = Vector2.zero
                TailLeftClip.Size = UDim2.fromOffset(7, 4)
                TailRightClip.Position = UDim2.fromScale(0, 1)
                TailRightClip.AnchorPoint = Vector2.yAxis
                TailRightClip.Size = UDim2.fromOffset(7, 4)
                TailLeft.Position = UDim2.new(1, 0, 0, 1)
                TailLeft.AnchorPoint = Vector2.new(0.5)
                TailRight.Position = UDim2.new(1, 0, 1, -1)
                TailRight.AnchorPoint = Vector2.new(0.5, 1)
            elseif Direction == 3 then -- Bottom
                AnchorPoint, TailAnchor = Vector2.new(0.5, 1), Vector2.new(0.5)
                TooltipLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
                TooltipLayout.VerticalAlignment = Enum.VerticalAlignment.Bottom
                TailContainer.Position = UDim2.fromScale(0.5, 1)
                TailContainer.Size = UDim2.fromOffset(8, 7)
                TailLeftClip.Position = UDim2.fromOffset()
                TailLeftClip.AnchorPoint = Vector2.zero
                TailLeftClip.Size = UDim2.fromOffset(4, 7)
                TailRightClip.Position = UDim2.fromScale(1)
                TailRightClip.AnchorPoint = Vector2.xAxis
                TailRightClip.Size = UDim2.fromOffset(4, 7)
                TailLeft.Position = UDim2.fromOffset(1)
                TailLeft.AnchorPoint = Vector2.new(0, 0.5)
                TailRight.Position = UDim2.new(1, -1)
                TailRight.AnchorPoint = Vector2.new(1, 0.5)
            end
            
            TailContainer.AnchorPoint = TailAnchor
            local TooltipPosition = Position + Size * TailAnchor
            local TooltipSize = TooltipFrame.AbsoluteSize
            
            TweenService:Create(TooltipContainer, TweenInfo.new(0.2), {
                Size = UDim2.fromOffset(TooltipSize.X, TooltipSize.Y),
                Position = UDim2.fromOffset(TooltipPosition.X, TooltipPosition.Y),
                AnchorPoint = AnchorPoint
            }):Play()
        end
        
        -- Button tooltips
        do
            local Tooltips = {}
            local WindowControls = SurfaceGui.Window.Content.TopBar.WindowControls
            
            local TooltipElements = {
                {SurfaceGui.Window.Content.Login.LoginBox.LoginLayout.LogIn, "Check Key", 1},
                {SurfaceGui.Window.Content.Login.DiscordButton, "Discord Server", 3},
                {WindowControls.Minimize, "Minimize", 1},
                {WindowControls.Maximize, "Mini View", 1},
                {WindowControls.Close, "Close", 1}
            }
            
            local CurrentActiveTab
            local CurrentActivePage
            local IsFirstTab = true
            
            local PageView = SurfaceGui.Window.Content.Hub.MainContent.PageView
            local NavButtons = SurfaceGui.Window.Content.Hub.MainContent.NavButtons
            local NavigationIcons = Resources.Icons.Navigation
            local NavComponent = Resources.Components.Nav
            
            for Index, TabData in next, {
                {"Home", NavigationIcons.home, PageView.Home},
                {"About", NavigationIcons.info, PageView.About},
                {"Settings", NavigationIcons.cog, PageView.Settings}
            } do
                local Tab = NavComponent:Clone()
                local Page = TabData[3]
                local TabName = TabData[1]
                
                Tab.Name = TabName
                Tab.LayoutOrder = Index
                TabData[2]:Clone().Parent = Tab.Icon
                
                table.insert(TooltipElements, {Tab, TabName, 2})
                
                Tab.Parent = NavButtons
                Tooltips[Tab] = TabName
                
                Tab.MouseButton1Click:Connect(function()
                    Page.Visible = true
                    TweenService:Create(CurrentActiveTab, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(82, 82, 82)}):Play()
                    TweenService:Create(Tab, TweenInfo.new(0.2), {BackgroundColor3 = ThemeColors.NavButtonActive.Value}):Play()
                    
                    local PreviousPage = CurrentActivePage
                    local PageOutTween = TweenService:Create(CurrentActivePage, TweenInfo.new(0.5), {Position = UDim2.fromScale(0.5, -1)})
                    PageOutTween:Play()
                    PageOutTween.Completed:Once(function(State)
                        if State == Enum.PlaybackState.Completed then
                            PreviousPage.Visible = false
                        end
                    end)
                    
                    TweenService:Create(Page, TweenInfo.new(0.5), {Position = UDim2.fromOffset()}):Play()
                    TweenService:Create(PageView.Parent, TweenInfo.new(0.5), {CanvasPosition = Vector2.zero}):Play()
                    
                    CurrentActiveTab = Tab
                    CurrentActivePage = Page
                end)
                
                if IsFirstTab then
                    IsFirstTab = false
                    Tab.BackgroundColor3 = ThemeColors.NavButtonActive.Value
                    CurrentActiveTab, CurrentActivePage = Tab, Page
                end
            end
            
            for _, ElementData in next, TooltipElements do
                local Element = ElementData[1]
                local TooltipText = ElementData[2]
                local TooltipDirection = ElementData[3]
                local ElementPosition = Element.AbsolutePosition
                
                Element.MouseEnter:Connect(function()
                    if not IsResizingSlider then
                        CurrentTooltipTarget = Element
                        TooltipLabel.Text = TooltipText
                        PositionTooltip(ElementPosition, Element.AbsoluteSize, TooltipDirection)
                    end
                end)
                
                Element.MouseLeave:Connect(function()
                    if CurrentTooltipTarget == Element and not IsResizingSlider then
                        TooltipHideTween:Play()
                    end
                end)
            end
        end
        
        -- Cleanup function
        function Cleanup()
            Resources.Bindables.HubDestroying:Fire()
            RenderConnection:Disconnect()
            InputBeganConnection:Disconnect()
            InputChangedConnection:Disconnect()
            InputEndedConnection:Disconnect()
            SurfaceGui:Destroy()
            Renderer:Destroy()
            PlayerGui:Destroy()
            
            -- Clear all references
            Config, WindowSize, CurrentCamera, SurfaceGui, PlayerGui, Resources, LoginWindow, KeyInput, ModalsContainer, ColorModal, Sidebar, PageContents, SubtitleText, VersionText, ThemeColors, ColorPickerUI, BasicColors, AdvancedColors, ColorPickerTitle, MinimizedTask, TweenService, EventHandlers, CurrentTooltip, ButtonCallbacks, PageCallbacks, SectionCallbacks, ElementCallbacks, DropdownCallbacks, TooltipContainer, TooltipHideTween, TooltipFrame, TooltipLabel, TooltipLayout, TailContainer, TailLeftClip, TailRightClip, TailLeft, TailRight, CurrentTooltipTarget, TooltipCount, ScreenContainer, HubPosition, Renderer, IsDraggingWindow, IsDraggingMinimized, IsResizingSlider, IsMinimized, IsSmall, IsWhitelist, OriginalPosition, LastTouchInput, InputBeganConnection, InputChangedConnection, InputEndedConnection, CurrentColor, CurrentColorValue, Hue, Saturation, Value, HuePad, ValueSlider, ColorPreview, HueCursor, ValueArrow, FineTuneValues, ColorInputValues, ColorInputPositions, ColorInputSelections, ColorPickerTarget = nil
            
            script:Destroy()
            script = nil
        end
        
        -- API object
        local IsFirstPage = true
        local CurrentActiveTab
        local CurrentActivePage
        
        local AlertTypes = {"Note", "Tip", "Important", "Warning", "Caution"}
        
        local HubAPI = {
            Base = PlayerGui,
            Screen = PlayerGui,
            Renderer = Renderer,
            Gui = SurfaceGui,
            
            Window = {
                Object = SurfaceGui.Window,
                IsMinimized = false,
                IsSmall = false,
                IsOpen = false,
                
                SetSubtitle = function(_, Title, Version)
                    SubtitleText.Text = Title
                    if Version ~= nil then
                        Version = tostring(Version)
                        VersionText.Text = Version
                        VersionText.Visible = true
                    else
                        VersionText.Visible = false
                    end
                end,
                
                ShowMessage = function(_, Title, Message)
                    -- Window:ShowDialog({Title = Title, Text = Message})
                end,
                
                ShowDialog = function(_, DialogData)
                    if type(DialogData) == "table" then
                        if not CurrentTooltip then
                            Resources.Tweens.ModalShadeFadeIn:Play()
                            TooltipCount = TooltipCount + 1
                            SurfaceGui.Window.Content.Interactable = false
                        end
                        
                        local Modal = Resources.Components.Modal:Clone()
                        
                        if DialogData.InfoLabel ~= nil then
                            -- Handle info label
                        end
                        
                        if DialogData.Transparent == false then
                            Modal.BackgroundTransparency = 0
                        end
                        
                        local Title = DialogData.Title
                        local Text = DialogData.Text
                        local Buttons = DialogData.Buttons
                        
                        if Title ~= nil then
                            Modal.Inner.DialogTitle.Text = tostring(Title)
                        end
                        
                        if Text ~= nil then
                            Modal.Inner.DialogText.Text = tostring(Text)
                        end
                        
                        local ToastFrameHeight = PlayerGui.ToastsFrame.AbsoluteSize.Y
                        local ModalHeight = Modal.AbsoluteSize.Y
                        Modal.Parent = ModalsContainer
                        
                        local function ShowNextModal()
                            local NextModal, NextData = next(EventHandlers)
                            if not CurrentTooltip then
                                if NextModal then
                                    ShowNextModal(NextModal)
                                else
                                    Resources.Tweens.ModalShadeFadeOut:Play()
                                    TooltipCount = TooltipCount - 1
                                    if TooltipCount == 0 then
                                        SurfaceGui.Window.Content.Interactable = true
                                    end
                                end
                            end
                        end
                        
                        local function CloseModal(Modal, Tween)
                            if Tween.PlaybackState ~= Enum.PlaybackState.Cancelled then
                                Modal:Destroy()
                                Tween:Destroy()
                                CurrentTooltip = false
                                ShowNextModal()
                            end
                        end
                        
                        local function AnimateModalOut(Modal)
                            for _, Child in pairs(Modal:GetChildren()) do
                                if Child:IsA("GuiButton") then
                                    Child.Interactable = false
                                end
                            end
                            
                            local OutTween = TweenService:Create(Modal, TweenInfo.new(0.25, Enum.EasingStyle.Quad, Enum.EasingDirection.In), {
                                Position = UDim2.fromScale(0.5, 1),
                                AnchorPoint = Vector2.new(0.5)
                            })
                            
                            OutTween.Completed:Once(CloseModal)
                            OutTween:Play()
                        end
                        
                        if not (type(Buttons) == "table" and #Buttons ~= 0) then
                            Buttons = {{Title = "OK"}}
                        end
                        
                        for _, ButtonData in next, Buttons do
                            if type(ButtonData) == "table" then
                                local Button = Resources.Components.ModalButton:Clone()
                                local ButtonTitle = ButtonData.Title
                                local ButtonCallback = ButtonData.Callback
                                
                                if ButtonTitle then
                                    Button.Text = tostring(ButtonTitle)
                                end
                                
                                if ButtonData.Secondary then
                                    Button.BackgroundColor3 = Color3.new(1, 1, 1)
                                end
                                
                                Button.MouseButton1Click:Connect(function()
                                    if type(ButtonCallback) == "function" then
                                        coroutine.resume(coroutine.create(ButtonCallback), ButtonTitle, Modal, DialogData.Nonce)
                                    end
                                    AnimateModalOut(Modal)
                                end)
                                
                                Button.Parent = Modal.Inner
                            end
                        end
                        
                        if DialogData.CopyBoxText ~= nil then
                            local CopyBox = Modal.Inner.CopyLayout.CopyBox
                            local CopyText = tostring(DialogData.CopyBoxText)
                            CopyBox.Text = CopyText
                            CopyBox.Parent.Visible = true
                            
                            local TextChangedConnection
                            CopyBox.Focused:Connect(function()
                                CopyBox.SelectionStart = 0
                                CopyBox.CursorPosition = #CopyBox.Text + 1
                                TextChangedConnection = CopyBox:GetPropertyChangedSignal("CursorPosition"):Connect(function()
                                    CopyBox.SelectionStart = 0
                                    CopyBox.CursorPosition = #CopyBox.Text + 1
                                end)
                            end)
                            
                            CopyBox.FocusLost:Connect(function()
                                TextChangedConnection:Disconnect()
                            end)
                            
                            local ClipboardFunction = setclipboard or toclipboard or set_clipboard or Clipboard and Clipboard.set or CopyString
                            local CopyButton = Modal.Inner.CopyLayout.CopyButton
                            
                            if ClipboardFunction then
                                Resources.Icons["20px"].copy:Clone().Parent = CopyButton
                                
                                CopyButton.MouseButton1Click:Connect(function()
                                    ClipboardFunction(CopyText)
                                    CopyButton.DoneFrame.Visible = true
                                    CopyButton.BackgroundColor3 = Color3.fromRGB(147, 112, 219) -- Medium purple
                                    TweenService:Create(CopyButton.DoneFrame, TweenInfo.new(5), {Visible = false}):Play()
                                    TweenService:Create(CopyButton, TweenInfo.new(5, Enum.EasingStyle.Back, Enum.EasingDirection.In), {BackgroundColor3 = Color3.fromRGB(230, 230, 250)}):Play()
                                end)
                            else
                                CopyButton.Visible = false
                            end
                        end
                        
                        function CloseModalByReference(Modal)
                            table.remove(EventHandlers, table.find(EventHandlers, Modal))
                            CurrentTooltip = true
                            
                            local CenterTween = TweenService:Create(Modal, TweenInfo.new(0.25), {
                                Position = UDim2.fromScale(0.5, 0.5),
                                AnchorPoint = Vector2.new(0.5, 0.5)
                            })
                            CenterTween:Play()
                        end
                        
                        table.insert(EventHandlers, Modal)
                        ShowNextModal()
                    end
                end,
                
                SetMinimized = function(_, Minimized, Animate)
                    if Minimized == nil then
                        Minimized = true
                    end
                    
                    if Animate == nil then
                        Animate = true
                    end
                    
                    if (not not Minimized) ~= IsMinimized then
                        IsMinimized = Minimized
                        
                        if Minimized then
                            OriginalPosition = ScreenContainer.Position
                            
                            if Animate then
                                local ExitTween = Resources.Tweens.GuiExit
                                TweenService:Create(ScreenContainer, TweenInfo.new(), {
                                    Position = UDim2.fromOffset(
                                        MinimizedTask.AbsolutePosition.X + MinimizedTask.AbsoluteSize.X/2,
                                        MinimizedTask.AbsolutePosition.Y + MinimizedTask.AbsoluteSize.Y/2
                                    )
                                }):Play()
                                Resources.Tweens.CanvasMin:Play()
                                ExitTween:Play()
                                -- Window.IsMinimized = Minimized
                                Resources.Bindables.MinimizedChanged:Fire(Minimized)
                                ExitTween.Completed:Once(function()
                                    MinimizedTask.Visible = true
                                end)
                            else
                                ScreenContainer.Position = UDim2.fromOffset(
                                    MinimizedTask.AbsolutePosition.X + MinimizedTask.AbsoluteSize.X/2,
                                    MinimizedTask.AbsolutePosition.Y + MinimizedTask.AbsoluteSize.Y/2
                                )
                                SurfaceGui.CanvasSize = Vector2.zero
                                ScreenContainer.Size = UDim2.fromOffset()
                                MinimizedTask.Visible = true
                                -- Window.IsMinimized = Minimized
                                Resources.Bindables.MinimizedChanged:Fire(Minimized)
                            end
                        else
                            MinimizedTask.Visible = false
                            ScreenContainer.Position = UDim2.fromOffset(
                                MinimizedTask.AbsolutePosition.X + MinimizedTask.AbsoluteSize.X/2,
                                MinimizedTask.AbsolutePosition.Y + MinimizedTask.AbsoluteSize.Y/2
                            )
                            
                            if Animate then
                                TweenService:Create(ScreenContainer, TweenInfo.new(), {Position = OriginalPosition}):Play()
                                
                                if IsSmall then
                                    Resources.Tweens.GuiHalf:Play()
                                else
                                    Resources.Tweens.GuiFull:Play()
                                end
                                
                                Resources.Tweens.CanvasFull:Play()
                            else
                                if IsSmall then
                                    ScreenContainer.Size = UDim2.fromScale(0.5, 0.5)
                                else
                                    ScreenContainer.Size = UDim2.fromScale(1, 1)
                                end
                                
                                SurfaceGui.CanvasSize = WindowSize
                            end
                            
                            -- Window.IsMinimized = not not Minimized
                            Resources.Bindables.MinimizedChanged:Fire(not not Minimized)
                        end
                    end
                end,
                
                SetSmall = function(_, Small, Animate)
                    if Small == nil then
                        Small = true
                    end
                    
                    if Animate == nil then
                        Animate = true
                    end
                    
                    if (not not Small) ~= IsSmall then
                        IsSmall = Small
                        
                        if Small then
                            if Animate then
                                Resources.Tweens.GuiHalf:Play()
                            else
                                ScreenContainer.Size = UDim2.fromScale(0.5, 0.5)
                            end
                        else
                            if Animate then
                                Resources.Tweens.GuiFull:Play()
                            else
                                ScreenContainer.Size = UDim2.fromScale(1, 1)
                            end
                        end
                        
                        -- Window.IsSmall = not not Small
                        Resources.Bindables.SizeChanged:Fire(not not Small)
                    end
                end,
                
                Open = function(_, Animate)
                    if Animate == nil then
                        Animate = true
                    end
                    
                    if not IsMinimized then
                        if Animate then
                            ScreenContainer.Size = UDim2.fromOffset()
                            SurfaceGui.CanvasSize = Vector2.zero
                            
                            if IsSmall then
                                Resources.Tweens.GuiEnterHalf:Play()
                            else
                                Resources.Tweens.GuiEnterFull:Play()
                            end
                            
                            Resources.Tweens.CanvasFull:Play()
                        else
                            if IsSmall then
                                ScreenContainer.Size = UDim2.fromScale(0.5, 0.5)
                            else
                                ScreenContainer.Size = UDim2.fromScale(1, 1)
                            end
                            
                            SurfaceGui.CanvasSize = WindowSize
                        end
                    end
                    
                    -- Window.IsOpen = true
                    Resources.Bindables.Opened:Fire()
                end,
                
                Close = function(_, Animate)
                    if Animate == nil then
                        Animate = true
                    end
                    
                    if Animate then
                        local ExitTween = Resources.Tweens.GuiExit
                        Resources.Tweens.CanvasMin:Play()
                        ExitTween:Play()
                        -- Window.IsOpen = false
                        Resources.Bindables.Closing:Fire()
                        ExitTween.Completed:Once(Cleanup)
                    else
                        -- Window.IsOpen = false
                        Resources.Bindables.Closing:Fire()
                        Cleanup()
                    end
                end,
                
                SetLoadingState = function(_, Loading)
                    Loading = not not Loading
                    local LoadingScreen = SurfaceGui.Window.LoadingScreen
                    
                    if LoadingScreen.Visible ~= Loading then
                        if Loading then
                            TooltipCount = TooltipCount + 1
                            SurfaceGui.Window.Content.Interactable = false
                        else
                            TooltipCount = TooltipCount - 1
                            if TooltipCount == 0 then
                                SurfaceGui.Window.Content.Interactable = true
                            end
                        end
                        
                        LoadingScreen.Visible = Loading
                    end
                end,
                
                MinimizedChanged = Resources.Bindables.MinimizedChanged.Event,
                SizeChanged = Resources.Bindables.SizeChanged.Event,
                Opened = Resources.Bindables.Opened.Event,
                Closing = Resources.Bindables.Closing.Event
            },
            
            Login = {
                Object = SurfaceGui.Window.Content.Login,
                IsWhitelist = false,
                
                SetKeyLink = function(_, Link)
                    Config.KEY_LINK = tostring(Link)
                end,
                
                SetWhitelistLink = function(_, Link)
                    Config.WHITELIST_LINK = tostring(Link)
                end,
                
                SetDiscordLink = function(_, Link)
                    Config.DISCORD_INVITE = tostring(Link)
                end,
                
                SetWhitelist = function(_, Whitelist)
                    IsWhitelist = Whitelist
                end,
                
                ChangeTheme = function(_, Theme)
                    -- Theme changing functionality
                end,
                
                WhitelistChanged = Resources.Bindables.WhitelistChanged.Event,
                LoginRequest = Resources.Bindables.LoginRequest.Event
            },
            
            Hub = {
                Object = SurfaceGui.Window.Content.Hub,
                
                CreatePage = function(_, PageName, Icon)
                    local Tab = Resources.Components.Tab:Clone()
                    local Page = Resources.Components.Page:Clone()
                    
                    Tab.Label.Text = PageName
                    Tab.Name = "Tab_" .. PageName
                    Page.Name = "Page_" .. PageName
                    
                    if Icon then
                        local IconImage = Resources.Icons["20px"]:FindFirstChild(Icon)
                        if IconImage then
                            IconImage:Clone().Parent = Tab.Icon
                        end
                    end
                    
                    Tab.Parent = Sidebar
                    Page.Parent = PageContents
                    
                    Tab.MouseButton1Click:Connect(function()
                        Page.Visible = true
                        TweenService:Create(CurrentActiveTab, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(82, 82, 82)}):Play()
                        TweenService:Create(Tab, TweenInfo.new(0.2), {BackgroundColor3 = ThemeColors.TabButtonActive.Value}):Play()
                        
                        local PreviousPage = CurrentActivePage
                        local PageOutTween = TweenService:Create(CurrentActivePage, TweenInfo.new(0.5), {Position = UDim2.fromScale(0.5, -1)})
                        PageOutTween:Play()
                        PageOutTween.Completed:Once(function(State)
                            if State == Enum.PlaybackState.Completed then
                                PreviousPage.Visible = false
                            end
                        end)
                        
                        TweenService:Create(Page, TweenInfo.new(0.5), {Position = UDim2.fromScale(0.5)}):Play()
                        TweenService:Create(PageContents.Parent, TweenInfo.new(0.5), {CanvasPosition = Vector2.zero}):Play()
                        
                        CurrentActiveTab = Tab
                        CurrentActivePage = Page
                    end)
                    
                    if IsFirstPage then
                        Page.Visible = true
                        Page.Position = UDim2.fromScale(0.5)
                        IsFirstPage = false
                        Tab.BackgroundColor3 = ThemeColors.TabButtonActive.Value
                        CurrentActiveTab, CurrentActivePage = Tab, Page
                    end
                    
                    return {
                        Instance = Page,
                        TabInstance = Tab,
                        Object = Tab,
                        Page = Page,
                        
                        CreateSection = function(_, SectionName, HideTitle, PageSection)
                            local Section = Resources.Components.Section:Clone()
                            Section.Name = "Section_" .. SectionName
                            Section.Title.Text = tostring(SectionName)
                            
                            if HideTitle then
                                Section.Title.Visible = false
                            end
                            
                            Section.Parent = Page
                            
                            return {
                                Object = Section,
                                HasSetVisibility = false,
                                
                                CreateSeparator = function(_)
                                    local Separator = Resources.Components.Separator:Clone()
                                    
                                    if not PageSection then
                                        Separator.Parent = Section.Object.ListBase
                                    else
                                        Separator.Parent = Section.Object
                                    end
                                end,
                                
                                CreateElement = function(_, ElementType, ElementData)
                                    if not _.HasSetVisibility then
                                        if not PageSection then
                                            Section.Object.ListBase.Visible = true
                                        end
                                        _.HasSetVisibility = true
                                    end
                                    
                                    ElementData = type(ElementData) == "table" and table.clone(ElementData) or {}
                                    
                                    function ElementData.SetLabel(_, LabelData)
                                        if type(LabelData) == "table" then
                                            local Title = LabelData.Title
                                            local Text = LabelData.Text
                                            
                                            if Title ~= nil then
                                                local TitleText = tostring(Title)
                                                Element.LabelContainer.Title.Text = TitleText
                                                Element.Label.Title = TitleText
                                            end
                                            
                                            if Text ~= nil then
                                                local TextContent = tostring(Text)
                                                Element.LabelContainer.Description.Text = TextContent
                                                Element.Label.Text = TextContent
                                            end
                                        end
                                    end
                                    
                                    local ElementEvent = Instance.new("BindableEvent")
                                    local ElementTemplate = Resources.Elements:FindFirstChild(ElementType)
                                    
                                    if ElementTemplate then
                                        ElementTemplate = ElementTemplate:Clone()
                                        ElementTemplate.Name = "Element_" .. ElementType
                                        
                                        if ElementType == "Alert" then
                                            local AlertType = tonumber(ElementData.Type)
                                            local AlertTypeName = AlertTypes[AlertType]
                                            local AccentColor
                                            
                                            if AlertTypeName then
                                                AccentColor = Resources.Styles.Alerts[AlertTypeName].AccentColor.Value
                                                ElementTemplate.Background.BackgroundColor3 = Resources.Styles.Alerts[AlertTypeName].PrimaryColor.Value
                                                
                                                local AlertIcon = Resources.Icons.Alerts[AlertTypeName]:Clone()
                                                
                                                for _, Child in next, AlertIcon:GetDescendants() do
                                                    if Child.ClassName == "Frame" then
                                                        Child.BackgroundColor3 = AccentColor
                                                    elseif Child.ClassName == "UIStroke" then
                                                        Child.Color = AccentColor
                                                    end
                                                end
                                                
                                                AlertIcon.Parent = ElementTemplate
                                            else
                                                ElementData.AlertType = 0
                                            end
                                            
                                            local Label = ElementTemplate.Label
                                            local LabelData = ElementData.Label
                                            LabelData = type(LabelData) == "table" and table.clone(LabelData) or {}
                                            
                                            local Title = LabelData.Title
                                            local Text = LabelData.Text
                                            Title = Title ~= nil and tostring(Title) or AlertTypeName
                                            Text = Text ~= nil and tostring(Text) or ""
                                            
                                            Label.Title.Text = Title
                                            Label.Description.Text = Text
                                            LabelData.Title = Title
                                            LabelData.Text = Text
                                            
                                            if AlertTypeName then
                                                Label.Title.TextColor3 = AccentColor
                                            end
                                            
                                            ElementData.LabelContainer = Label
                                            ElementData.Label = LabelData
                                        else
                                            local Label = Resources.Components.Label:Clone()
                                            local LabelData = ElementData.Label
                                            LabelData = type(LabelData) == "table" and table.clone(LabelData) or {}
                                            
                                            local Title = LabelData.Title
                                            local Text = LabelData.Text
                                            Title = Title ~= nil and tostring(Title) or ""
                                            Text = Text ~= nil and tostring(Text) or ""
                                            
                                            Label.Title.Text = Title
                                            Label.Description.Text = Text
                                            LabelData.Title = Title
                                            LabelData.Text = Text
                                            
                                            Label.Parent = ElementTemplate
                                            ElementData.LabelContainer = Label
                                            ElementData.Label = LabelData
                                            
                                            if ElementType == "Toggle" then
                                                local ToggleFrame = ElementTemplate.Base.ToggleFrame
                                                local Tick1 = ToggleFrame.Tick1.Target
                                                local Tick2 = ToggleFrame.Tick2.Target
                                                local IsToggled = not not ElementData.Value
                                                
                                                if IsToggled then
                                                    Tick1.Size = UDim2.fromOffset(8, 2)
                                                    Tick2.Size = UDim2.fromOffset(14, 2)
                                                    ToggleFrame.BackgroundColor3 = Color3.fromRGB(147, 112, 219) -- Medium purple
                                                end
                                                
                                                ElementData.Value = IsToggled
                                                
                                                local ToggleOnTween = TweenService:Create(ToggleFrame, TweenInfo.new(0.5), {BackgroundColor3 = Color3.fromRGB(147, 112, 219)})
                                                local Tick1OnTween = TweenService:Create(Tick1, TweenInfo.new(0.5, Enum.EasingStyle.Back), {Size = UDim2.fromOffset(8, 2)})
                                                local Tick2OnTween = TweenService:Create(Tick2, TweenInfo.new(0.5, Enum.EasingStyle.Back), {Size = UDim2.fromOffset(14, 2)})
                                                
                                                local ToggleOffTween = TweenService:Create(ToggleFrame, TweenInfo.new(0.5, Enum.EasingStyle.Quad, Enum.EasingDirection.In), {BackgroundColor3 = Color3.new()})
                                                local Tick1OffTween = TweenService:Create(Tick1, TweenInfo.new(0.5, Enum.EasingStyle.Back, Enum.EasingDirection.In), {Size = UDim2.fromOffset()})
                                                local Tick2OffTween = TweenService:Create(Tick2, TweenInfo.new(0.5, Enum.EasingStyle.Back, Enum.EasingDirection.In), {Size = UDim2.fromOffset()})
                                                
                                                local function Toggle()
                                                    IsToggled = not IsToggled
                                                    
                                                    if IsToggled then
                                                        ToggleOnTween:Play()
                                                        Tick1OnTween:Play()
                                                        Tick2OnTween:Play()
                                                    else
                                                        ToggleOffTween:Play()
                                                        Tick1OffTween:Play()
                                                        Tick2OffTween:Play()
                                                    end
                                                    
                                                    ElementData.Value = IsToggled
                                                    local OnChanged = ElementData.OnChanged
                                                    OnChanged = type(OnChanged) == "function" and OnChanged or nil
                                                    
                                                    if OnChanged then
                                                        coroutine.resume(coroutine.create(OnChanged), IsToggled)
                                                    end
                                                end
                                                
                                                ElementTemplate.ClickArea.MouseButton1Click:Connect(Toggle)
                                                
                                                function ElementData.SetValue(_, Value)
                                                    if Value ~= IsToggled then
                                                        Toggle()
                                                    end
                                                end
                                                
                                                ElementData.Toggle = Toggle
                                            elseif ElementType == "Dropdown" then
                                                local IsDropdownOpen = false
                                                local Values = {}
                                                local Options = {}
                                                local OptionElements = {}
                                                local OptionTexts = {}
                                                local OptionTweens = {}
                                                local OptionTweensOut = {}
                                                
                                                local DropdownList = ElementTemplate.Base.DropDownContainer.List.Options
                                                local DropdownLabel = ElementTemplate.Base.DropDownContainer.Label.OptionText
                                                local CurrentDropdown
                                                local IsInitialized = false
                                                
                                                local PlaceholderText = ElementData.PlaceholderText
                                                PlaceholderText = PlaceholderText and tostring(PlaceholderText) or "Select..."
                                                ElementData.PlaceholderText = PlaceholderText
                                                DropdownLabel.Text = PlaceholderText
                                                
                                                local SelectedValues = ElementData.Selected
                                                ElementData.Selected = SelectedValues
                                                
                                                function ElementData.AddValues(_, NewValues, NewSelected)
                                                    -- Add values functionality
                                                end
                                                
                                                function ElementData.SetValues(_, NewValues, NewSelected)
                                                    if IsInitialized then
                                                        ElementData.Selected = SelectedValues
                                                    end
                                                    
                                                    NewValues = type(NewValues) == "table" and NewValues or {NewValues}
                                                    
                                                    if NewSelected ~= nil then
                                                        NewSelected = type(NewSelected) == "table" and NewSelected or {NewSelected}
                                                    end
                                                    
                                                    if NewValues ~= nil and NewValues ~= Values then
                                                        table.clear(Values)
                                                        for _, Value in next, NewValues do
                                                            Values[Value] = Value
                                                        end
                                                        Values = table.clone(NewValues)
                                                        NewValues = nil
                                                    end
                                                    
                                                    local ElementsToRemove = {}
                                                    local NewOptionElements = table.clone(Values)
                                                    
                                                    for OptionElement, Value in pairs(OptionElements) do
                                                        local Index = table.find(NewOptionElements, Value)
                                                        
                                                        if Index then
                                                            table.remove(NewOptionElements, Index)
                                                            
                                                            local IsSelected = table.find(SelectedValues, Value)
                                                            
                                                            if NewSelected ~= nil then
                                                                local IsNewSelected = table.find(NewSelected, Value)
                                                                
                                                                if IsNewSelected and not IsSelected then
                                                                    OptionElement.BackgroundColor3 = Color3.fromRGB(147, 112, 219) -- Medium purple
                                                                elseif not IsNewSelected and IsSelected then
                                                                    OptionElement.BackgroundColor3 = Color3.fromRGB(82, 82, 82)
                                                                end
                                                            end
                                                        else
                                                            OptionElement:Destroy()
                                                            table.insert(ElementsToRemove, OptionElement)
                                                            
                                                            if not table.find(Values, Value) then
                                                                OptionTexts[Value] = nil
                                                            end
                                                        end
                                                    end
                                                    
                                                    for _, Element in pairs(ElementsToRemove) do
                                                        OptionElements[Element] = nil
                                                    end
                                                    
                                                    local FinalSelected
                                                    local FinalSelectedClone
                                                    local FinalSelectedToCompare
                                                    
                                                    if NewSelected ~= nil and NewSelected ~= SelectedValues then
                                                        FinalSelected = NewSelected
                                                        FinalSelectedClone = table.clone(NewSelected)
                                                        FinalSelectedToCompare = NewSelected
                                                    else
                                                        FinalSelected = SelectedValues
                                                        FinalSelectedClone = table.clone(SelectedValues)
                                                        FinalSelectedToCompare = FinalSelectedClone
                                                    end
                                                    
                                                    for _, Value in pairs(FinalSelectedClone) do
                                                        if not table.find(Values, Value) then
                                                            table.remove(FinalSelected, table.find(FinalSelected, Value))
                                                        end
                                                    end
                                                    
                                                    local SelectionChanged = (function(OldSelection, NewSelection)
                                                        for Key, Value in next, OldSelection do
                                                            if NewSelection[Key] ~= Value then
                                                                return 1
                                                            end
                                                        end
                                                        
                                                        for Key, Value in next, NewSelection do
                                                            if OldSelection[Key] ~= Value then
                                                                return 1
                                                            end
                                                        end
                                                    end)(SelectedValues, FinalSelectedToCompare)
                                                    
                                                    if FinalSelected == FinalSelectedToCompare then
                                                        table.clear(SelectedValues)
                                                        
                                                        for _, Value in next, NewSelected do
                                                            SelectedValues[Value] = Value
                                                        end
                                                    end
                                                    
                                                    if SelectionChanged then
                                                        local OnSelectionChanged = ElementData.OnSelectionChanged
                                                        OnSelectionChanged = type(OnSelectionChanged) == "function" and OnSelectionChanged or nil
                                                        
                                                        if OnSelectionChanged and IsInitialized then
                                                            coroutine.resume(coroutine.create(OnSelectionChanged), SelectedValues)
                                                        end
                                                    end
                                                    
                                                    FinalSelectedClone = nil
                                                    
                                                    for _, Value in pairs(NewOptionElements) do
                                                        local Option = Resources.Components.DropDownOption:Clone()
                                                        OptionTexts[Value] = tostring(Value)
                                                        Option.Text = OptionTexts[Value]
                                                        Option.Parent = DropdownList
                                                        
                                                        local OptionOnTween = TweenService:Create(Option, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(147, 112, 219)})
                                                        local OptionOffTween = TweenService:Create(Option, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(82, 82, 82)})
                                                        
                                                        OptionTweens[Value] = OptionOnTween
                                                        OptionTweensOut[Value] = OptionOffTween
                                                        
                                                        local IsSelected = table.find(SelectedValues, Value)
                                                        
                                                        if IsSelected then
                                                            OptionOnTween:Play()
                                                        end
                                                        
                                                        if typeof(Value) == "Instance" then
                                                            Value:GetPropertyChangedSignal("Name"):Connect(function()
                                                                OptionTexts[Value] = tostring(Value)
                                                                Option.Text = OptionTexts[Value]
                                                                
                                                                if #SelectedValues > 0 then
                                                                    local Text = ""
                                                                    
                                                                    for _, Value in pairs(SelectedValues) do
                                                                        if next(SelectedValues, _) then
                                                                            Text = Text .. OptionTexts[Value] .. ", "
                                                                        else
                                                                            Text = Text .. OptionTexts[Value]
                                                                        end
                                                                    end
                                                                    
                                                                    DropdownLabel.Text = Text
                                                                end
                                                            end)
                                                            
                                                            Value.Destroying:Once(function()
                                                                local Index = table.find(Values, Value)
                                                                local SelectedIndex = table.find(SelectedValues, Value)
                                                                
                                                                if Index then
                                                                    table.remove(Values, Index)
                                                                    Option:Destroy()
                                                                    
                                                                    if Value.Parent then
                                                                        OptionElements[Option] = nil
                                                                    end
                                                                    
                                                                    if not table.find(Values, Value) then
                                                                        OptionTexts[Value] = nil
                                                                    end
                                                                end
                                                                
                                                                if SelectedIndex then
                                                                    table.remove(SelectedValues, SelectedIndex)
                                                                end
                                                                
                                                                if #SelectedValues > 0 then
                                                                    local Text = ""
                                                                    
                                                                    for _, Value in pairs(SelectedValues) do
                                                                        if next(SelectedValues, _) then
                                                                            Text = Text .. OptionTexts[Value] .. ", "
                                                                        else
                                                                            Text = Text .. OptionTexts[Value]
                                                                        end
                                                                    end
                                                                    
                                                                    DropdownLabel.Text = Text
                                                                else
                                                                    DropdownLabel.Text = PlaceholderText
                                                                    DropdownLabel.TextColor3 = Color3.fromRGB(178, 178, 178)
                                                                end
                                                            end)
                                                        end
                                                        
                                                        Option.MouseButton1Click:Connect(function()
                                                            local OnValueSelected = ElementData.OnValueSelected
                                                            local OnValueUnselected = ElementData.OnValueUnselected
                                                            local OnSelectionDifference = ElementData.OnSelectionDifference
                                                            local OnSelectionChanged = ElementData.OnSelectionChanged
                                                            
                                                            OnValueSelected = type(OnValueSelected) == "function" and OnValueSelected or nil
                                                            OnValueUnselected = type(OnValueUnselected) == "function" and OnValueUnselected or nil
                                                            OnSelectionDifference = type(OnSelectionDifference) == "function" and OnSelectionDifference or nil
                                                            OnSelectionChanged = type(OnSelectionChanged) == "function" and OnSelectionChanged or nil
                                                            
                                                            if ElementData.MultiSelect then
                                                                local Index = table.find(SelectedValues, Value)
                                                                
                                                                if Index then
                                                                    OptionOffTween:Play()
                                                                    table.remove(SelectedValues, Index)
                                                                    
                                                                    if OnValueUnselected then
                                                                        coroutine.resume(coroutine.create(OnValueUnselected), Value)
                                                                    end
                                                                    
                                                                    if OnSelectionDifference then
                                                                        coroutine.resume(coroutine.create(OnSelectionDifference), nil, Value)
                                                                    end
                                                                else
                                                                    OptionOnTween:Play()
                                                                    table.insert(SelectedValues, Value)
                                                                    
                                                                    if OnValueSelected then
                                                                        coroutine.resume(coroutine.create(OnValueSelected), Value)
                                                                    end
                                                                    
                                                                    if OnSelectionDifference then
                                                                        coroutine.resume(coroutine.create(OnSelectionDifference), Value, nil)
                                                                    end
                                                                end
                                                                
                                                                if OnSelectionChanged then
                                                                    coroutine.resume(coroutine.create(OnSelectionChanged), SelectedValues)
                                                                end
                                                            else
                                                                local HasDeselected
                                                                local DeselectedValues = {}
                                                                
                                                                for _, SelectedValue in pairs(SelectedValues) do
                                                                    if Value ~= SelectedValue then
                                                                        OptionTweensOut[SelectedValue]:Play()
                                                                        HasDeselected = true
                                                                        table.insert(DeselectedValues, SelectedValue)
                                                                    end
                                                                end
                                                                
                                                                local Index = table.find(SelectedValues, Value)
                                                                
                                                                if Index then
                                                                    if not (ElementData.SelectionLocks or ElementData.SelectionForced) then
                                                                        OptionOffTween:Play()
                                                                        table.clear(SelectedValues)
                                                                        
                                                                        if OnSelectionChanged then
                                                                            coroutine.resume(coroutine.create(OnSelectionChanged), SelectedValues)
                                                                        end
                                                                        
                                                                        if OnValueUnselected then
                                                                            coroutine.resume(coroutine.create(OnValueUnselected), Value)
                                                                        end
                                                                        
                                                                        if HasDeselected then
                                                                            for _, DeselectedValue in pairs(DeselectedValues) do
                                                                                if OnValueUnselected then
                                                                                    coroutine.resume(coroutine.create(OnValueUnselected), DeselectedValue)
                                                                                end
                                                                            end
                                                                            
                                                                            for _, DeselectedValue in pairs(DeselectedValues) do
                                                                                if OnSelectionDifference then
                                                                                    coroutine.resume(coroutine.create(OnSelectionDifference), nil, DeselectedValue)
                                                                                end
                                                                            end
                                                                        end
                                                                        
                                                                        if OnSelectionDifference then
                                                                            coroutine.resume(coroutine.create(OnSelectionDifference), nil, Value)
                                                                        end
                                                                    else
                                                                        if HasDeselected then
                                                                            for _, DeselectedValue in pairs(DeselectedValues) do
                                                                                if OnValueUnselected then
                                                                                    coroutine.resume(coroutine.create(OnValueUnselected), DeselectedValue)
                                                                                end
                                                                            end
                                                                            
                                                                            for _, DeselectedValue in pairs(DeselectedValues) do
                                                                                if OnSelectionDifference then
                                                                                    coroutine.resume(coroutine.create(OnSelectionDifference), nil, DeselectedValue)
                                                                                end
                                                                            end
                                                                        end
                                                                    end
                                                                else
                                                                    OptionOnTween:Play()
                                                                    table.clear(SelectedValues)
                                                                    SelectedValues[1] = Value
                                                                    
                                                                    if OnSelectionChanged then
                                                                        coroutine.resume(coroutine.create(OnSelectionChanged), SelectedValues)
                                                                    end
                                                                    
                                                                    if OnValueSelected then
                                                                        coroutine.resume(coroutine.create(OnValueSelected), Value)
                                                                    end
                                                                    
                                                                    if HasDeselected then
                                                                        for _, DeselectedValue in pairs(DeselectedValues) do
                                                                            if OnValueUnselected then
                                                                                coroutine.resume(coroutine.create(OnValueUnselected), DeselectedValue)
                                                                            end
                                                                        end
                                                                        
                                                                        for _, DeselectedValue in pairs(DeselectedValues) do
                                                                            if OnSelectionDifference then
                                                                                coroutine.resume(coroutine.create(OnSelectionDifference), Value, DeselectedValue)
                                                                            end
                                                                        end
                                                                    else
                                                                        if OnSelectionDifference then
                                                                            coroutine.resume(coroutine.create(OnSelectionDifference), Value, nil)
                                                                        end
                                                                    end
                                                                end
                                                            end
                                                            
                                                            if #SelectedValues > 0 then
                                                                local Text = ""
                                                                
                                                                for _, Value in pairs(SelectedValues) do
                                                                    if next(SelectedValues, _) then
                                                                        Text = Text .. OptionTexts[Value] .. ", "
                                                                    else
                                                                        Text = Text .. OptionTexts[Value]
                                                                    end
                                                                end
                                                                
                                                                DropdownLabel.Text = Text
                                                                DropdownLabel.TextColor3 = Color3.new(1, 1, 1)
                                                            else
                                                                DropdownLabel.Text = PlaceholderText
                                                                DropdownLabel.TextColor3 = Color3.fromRGB(178, 178, 178)
                                                            end
                                                            
                                                            CurrentDropdown = Option
                                                        end)
                                                        
                                                        OptionElements[Option] = Value
                                                    end
                                                    
                                                    if #SelectedValues > 0 then
                                                        local Text = ""
                                                        
                                                        for _, Value in pairs(SelectedValues) do
                                                            if next(SelectedValues, _) then
                                                                Text = Text .. OptionTexts[Value] .. ", "
                                                            else
                                                                Text = Text .. OptionTexts[Value]
                                                            end
                                                        end
                                                        
                                                        DropdownLabel.Text = Text
                                                        DropdownLabel.TextColor3 = Color3.new(1, 1, 1)
                                                    else
                                                        DropdownLabel.Text = PlaceholderText
                                                        DropdownLabel.TextColor3 = Color3.fromRGB(178, 178, 178)
                                                    end
                                                end
                                                
                                                function ElementData.RemoveValues(_, ValuesToRemove)
                                                    -- Remove values functionality
                                                end
                                                
                                                function ElementData.AddSelection(_, NewSelection)
                                                    -- Add selection functionality
                                                end
                                                
                                                function ElementData.SetSelection(_, NewSelection)
                                                    ElementData:SetValues(ElementData.Values, NewSelection)
                                                end
                                                
                                                function ElementData.RemoveSelection(_, SelectionToRemove)
                                                    -- Remove selection functionality
                                                end
                                                
                                                ElementData:SetValues(ElementData.Values, {})
                                                ElementData:SetValues(ElementData.Values, ElementData.Selected)
                                                NewValues = nil
                                                IsInitialized = true
                                                
                                                local DropdownOpenTween = TweenService:Create(ElementTemplate.Base.DropDownContainer.List, TweenInfo.new(0.5), {Size = UDim2.new(1, 0, 0, 150)})
                                                local DropdownCloseTween = TweenService:Create(ElementTemplate.Base.DropDownContainer.List, TweenInfo.new(0.5), {Size = UDim2.fromScale(1)})
                                                local ArrowOpenTween = TweenService:Create(ElementTemplate.Base.DropDownContainer.Label.Arrow.Clip, TweenInfo.new(0.5), {Position = UDim2.fromOffset(), AnchorPoint = Vector2.zero})
                                                local ArrowCloseTween = TweenService:Create(ElementTemplate.Base.DropDownContainer.Label.Arrow.Clip, TweenInfo.new(0.5), {Position = UDim2.fromScale(0, 1), AnchorPoint = Vector2.yAxis})
                                                
                                                ElementTemplate.Base.DropDownContainer.MouseButton1Click:Connect(function()
                                                    IsDropdownOpen = not IsDropdownOpen
                                                    
                                                    if IsDropdownOpen then
                                                        ElementTemplate.Base.DropDownContainer.List.Visible = true
                                                        DropdownOpenTween:Play()
                                                        ArrowOpenTween:Play()
                                                    else
                                                        DropdownCloseTween:Play()
                                                        ArrowCloseTween:Play()
                                                        DropdownCloseTween.Completed:Once(function(State)
                                                            if State == Enum.PlaybackState.Completed then
                                                                ElementTemplate.Base.DropDownContainer.List.Visible = false
                                                            end
                                                        end)
                                                    end
                                                end)
                                            elseif ElementType == "ColorPicker" then
                                                local ColorDisplay = ElementTemplate.Base.Color
                                                local ColorValue = ElementData.Value
                                                
                                                if typeof(ColorValue) == "Color3" then
                                                    -- Use as is
                                                elseif typeof(ColorValue) == "BrickColor" then
                                                    ColorValue = ColorValue.Color
                                                elseif type(ColorValue) == "string" then
                                                    local Success, NewColor = pcall(Color3.fromHex, ColorValue)
                                                    ColorValue = Success and NewColor or Color3.new()
                                                else
                                                    ColorValue = Color3.new()
                                                end
                                                
                                                ColorDisplay.BackgroundColor3 = ColorValue
                                                ElementData.Value = ColorValue
                                                
                                                local function OpenColorPicker()
                                                    ColorPickerTarget = ElementTemplate.Base.Color
                                                    CurrentColor = ElementData.Value
                                                    CurrentColorValue = ElementData
                                                    
                                                    ColorPickerUI.Size = UDim2.fromOffset(384, 384)
                                                    BasicColors.Visible = true
                                                    AdvancedColors.Visible = false
                                                    ColorPickerTitle.Text = "Basic Colors"
                                                    
                                                    Resources.Tweens.ColorPickerOpen:Play()
                                                    Resources.Tweens.ColorModalShadeFadeIn:Play()
                                                    
                                                    TooltipCount = TooltipCount + 1
                                                    SurfaceGui.Window.Content.Interactable = false
                                                    
                                                    local Red, Green, Blue = math.floor(CurrentColor.R * 255), math.floor(CurrentColor.G * 255), math.floor(CurrentColor.B * 255)
                                                    local MaxValue, MinValue = math.max(Red, Green, Blue), math.min(Red, Green, Blue)
                                                    
                                                    local NewHue, NewSaturation, NewValue
                                                    NewValue = MaxValue
                                                    local Delta = MaxValue - MinValue
                                                    
                                                    if MaxValue == 0 then
                                                        NewSaturation = 0
                                                    else
                                                        NewSaturation = (Delta * 255) / MaxValue
                                                    end
                                                    
                                                    if MaxValue == MinValue then
                                                        NewHue = 0
                                                    else
                                                        if MaxValue == Red then
                                                            NewHue = ((Green - Blue) * 60) / Delta
                                                            if Green < Blue then
                                                                NewHue = NewHue + 360
                                                            end
                                                        elseif MaxValue == Green then
                                                            NewHue = ((Blue - Red) * 60) / Delta + 120
                                                        elseif MaxValue == Blue then
                                                            NewHue = ((Red - Green) * 60) / Delta + 240
                                                        end
                                                    end
                                                    
                                                    Hue, Saturation, Value = NewHue / 360, NewSaturation / 255, NewValue / 255
                                                    
                                                    local HexColor = CurrentColor:ToHex()
                                                    
                                                    FineTuneValues.R.TextBox.Text = Red
                                                    FineTuneValues.G.TextBox.Text = Green
                                                    FineTuneValues.B.TextBox.Text = Blue
                                                    FineTuneValues.Hex.TextBox.Text = "#" .. HexColor
                                                    FineTuneValues.Hue.TextBox.Text = math.floor(NewHue)
                                                    FineTuneValues.Sat.TextBox.Text = math.round(NewSaturation)
                                                    FineTuneValues.Val.TextBox.Text = math.round(NewValue)
                                                    
                                                    ColorInputValues[FineTuneValues.R.TextBox] = FineTuneValues.R.TextBox.Text
                                                    ColorInputValues[FineTuneValues.G.TextBox] = FineTuneValues.G.TextBox.Text
                                                    ColorInputValues[FineTuneValues.B.TextBox] = FineTuneValues.B.TextBox.Text
                                                    ColorInputValues[FineTuneValues.Hex.TextBox] = FineTuneValues.Hex.TextBox.Text
                                                    ColorInputValues[FineTuneValues.Hue.TextBox] = FineTuneValues.Hue.TextBox.Text
                                                    ColorInputValues[FineTuneValues.Sat.TextBox] = FineTuneValues.Sat.TextBox.Text
                                                    ColorInputValues[FineTuneValues.Val.TextBox] = FineTuneValues.Val.TextBox.Text
                                                    
                                                    HueCursor.Position = UDim2.fromScale(1 - NewHue / 359, 1 - NewSaturation)
                                                    ValueArrow.Position = UDim2.fromScale(0, 1 - NewValue)
                                                    ColorPreview.BackgroundColor3 = CurrentColor
                                                    ValueSlider.BackgroundColor3 = Color3.fromHSV(Hue, Saturation, 1)
                                                end
                                                
                                                ElementTemplate.ClickArea.MouseButton1Click:Connect(OpenColorPicker)
                                                
                                                function ElementData.SetValue(_, NewColor)
                                                    local OldColor = ElementData.Value
                                                    
                                                    if typeof(NewColor) == "Color3" then
                                                        ColorValue = NewColor
                                                    elseif typeof(NewColor) == "BrickColor" then
                                                        ColorValue = NewColor.Color
                                                    elseif type(NewColor) == "string" then
                                                        local Success, NewColorValue = pcall(Color3.fromHex, NewColor)
                                                        ColorValue = Success and NewColorValue or Color3.new()
                                                    else
                                                        ColorValue = Color3.new()
                                                    end
                                                    
                                                    if OldColor ~= ColorValue then
                                                        ColorDisplay.BackgroundColor3 = ColorValue
                                                        ElementData.Value = ColorValue
                                                        
                                                        local OnChanged = ElementData.OnChanged
                                                        OnChanged = type(OnChanged) == "function" and OnChanged or nil
                                                        
                                                        if OnChanged then
                                                            coroutine.resume(coroutine.create(OnChanged), ColorValue, 0)
                                                        end
                                                    end
                                                end
                                                
                                                ElementData.Open = OpenColorPicker
                                            elseif ElementType == "Button" then
                                                local ButtonText = ElementData.Text
                                                
                                                if ButtonText == nil or ElementData.Simple then
                                                    ElementData.Simple = true
                                                    ElementTemplate.Base.Button:Destroy()
                                                    ElementTemplate.Base.UIPadding:Destroy()
                                                    Resources.Components.ButtonArrow:Clone().Parent = ElementTemplate.Base
                                                    ElementTemplate.Size = UDim2.fromOffset(60, 60)
                                                    
                                                    function ElementData.SetText(_, NewText)
                                                        -- Simple button text change functionality
                                                    end
                                                else
                                                    local Label = ElementTemplate.Base.Button.Label
                                                    ButtonText = ButtonText and tostring(ButtonText) or "Button"
                                                    Label.Text = ButtonText
                                                    ElementData.Text = ButtonText
                                                    
                                                    function ElementData.SetText(_, NewText)
                                                        NewText = tostring(NewText)
                                                        Label.Text = NewText
                                                        ElementData.Text = NewText
                                                    end
                                                end
                                                
                                                ElementData.Click = ElementTemplate.ClickArea.MouseButton1Click
                                            elseif ElementType == "Slider" then
                                                local SliderBase = ElementTemplate.Base
                                                local SliderKnob = SliderBase.Track.InnerTrack.Knob
                                                local SliderFill = SliderBase.Track.Fill
                                                
                                                local MinValue = tonumber(ElementData.Min) or 0
                                                local MaxValue = tonumber(ElementData.Max) or 100
                                                local CurrentValue = tonumber(ElementData.Value) or (MaxValue < MinValue and MinValue or MinValue + (MaxValue - MinValue) / 2)
                                                local StepValue = tonumber(ElementData.Step)
                                                local IsPercent = not not ElementData.IsPercent
                                                
                                                StepValue = StepValue and 1 / StepValue or 1
                                                local Range = (MaxValue - MinValue)
                                                CurrentValue = math.clamp((CurrentValue - MinValue) / Range, 0, 1)
                                                
                                                local ValueFormat
                                                
                                                if StepValue ~= math.huge and StepValue ~= -math.huge then
                                                    local Range = (MaxValue - MinValue)
                                                    ValueFormat = math.round((MinValue + (CurrentValue * Range)) * StepValue) / StepValue
                                                    local KnobPosition = UDim2.fromScale((ValueFormat - MinValue) / Range, 1)
                                                    SliderKnob.Position = KnobPosition
                                                    SliderFill.Size = KnobPosition
                                                    ValueFormat = 1 / ValueFormat ~= -math.huge and ValueFormat or 0
                                                else
                                                    ValueFormat = MinValue + (CurrentValue * (MaxValue - MinValue))
                                                    SliderKnob.Position = UDim2.fromScale(CurrentValue, 0.5)
                                                    SliderFill.Size = UDim2.fromScale(CurrentValue, 1)
                                                end
                                                
                                                ValueFormat = math.clamp(ValueFormat, MinValue, MaxValue)
                                                TooltipLabel.Text = ElementData.IsPercent and ValueFormat or math.round(100 * ValueFormat) .. "%"
                                                
                                                local TooltipSize = TooltipFrame.AbsoluteSize
                                                TooltipContainer.Size = UDim2.fromOffset(TooltipSize.X, TooltipSize.Y)
                                                
                                                if ElementData.Value ~= ValueFormat then
                                                    ElementData.Value = ValueFormat
                                                    local OnChanged = ElementData.OnChanged
                                                    OnChanged = type(OnChanged) == "function" and OnChanged or nil
                                                    
                                                    if OnChanged then
                                                        coroutine.resume(coroutine.create(OnChanged), ValueFormat)
                                                    end
                                                end
                                                
                                                -- Slider interaction
                                                local IsDraggingSlider = false
                                                local SliderStartPos
                                                
                                                SliderBase.InputBegan:Connect(function(Input)
                                                    if Input.UserInputType == Enum.UserInputType.MouseButton1 or Input.UserInputType == Enum.UserInputType.Touch then
                                                        IsDraggingSlider = true
                                                        SliderStartPos = Input.Position
                                                        CurrentSlider = SliderKnob
                                                        SliderValue = ElementData
                                                        IsResizingSlider = true
                                                    end
                                                end)
                                                
                                                local SliderInputChangedConnection
                                                SliderInputChangedConnection = game:GetService("UserInputService").InputChanged:Connect(function(Input)
                                                    if IsDraggingSlider then
                                                        if Input.UserInputType == Enum.UserInputType.MouseMovement or (Input.UserInputType == Enum.UserInputType.Touch and Input == LastTouchInput) then
                                                            local RelativePosition = (Input.Position.X - SliderBase.AbsolutePosition.X) / SliderBase.AbsoluteSize.X
                                                            RelativePosition = math.clamp(RelativePosition, 0, 1)
                                                            
                                                            local NewValue
                                                            
                                                            if StepValue ~= math.huge and StepValue ~= -math.huge then
                                                                NewValue = math.round((MinValue + (RelativePosition * Range)) * StepValue) / StepValue
                                                                local KnobPosition = UDim2.fromScale((NewValue - MinValue) / Range, 1)
                                                                SliderKnob.Position = KnobPosition
                                                                SliderFill.Size = KnobPosition
                                                            else
                                                                NewValue = MinValue + (RelativePosition * (MaxValue - MinValue))
                                                                SliderKnob.Position = UDim2.fromScale(RelativePosition, 0.5)
                                                                SliderFill.Size = UDim2.fromScale(RelativePosition, 1)
                                                            end
                                                            
                                                            NewValue = math.clamp(NewValue, MinValue, MaxValue)
                                                            TooltipLabel.Text = ElementData.IsPercent and NewValue or math.round(100 * NewValue) .. "%"
                                                            
                                                            local TooltipSize = TooltipFrame.AbsoluteSize
                                                            TooltipContainer.Size = UDim2.fromOffset(TooltipSize.X, TooltipSize.Y)
                                                            
                                                            if ElementData.Value ~= NewValue then
                                                                ElementData.Value = NewValue
                                                                local OnChanged = ElementData.OnChanged
                                                                OnChanged = type(OnChanged) == "function" and OnChanged or nil
                                                                
                                                                if OnChanged then
                                                                    coroutine.resume(coroutine.create(OnChanged), NewValue)
                                                                end
                                                            end
                                                        end
                                                    end
                                                end)
                                                
                                                local SliderInputEndedConnection
                                                SliderInputEndedConnection = game:GetService("UserInputService").InputEnded:Connect(function(Input)
                                                    if Input.UserInputType == Enum.UserInputType.MouseButton1 or (Input.UserInputType == Enum.UserInputType.Touch and Input == LastTouchInput) then
                                                        if IsDraggingSlider then
                                                            IsDraggingSlider = false
                                                            CurrentSlider = nil
                                                            SliderValue = nil
                                                            IsResizingSlider = false
                                                            
                                                            if CurrentTooltipTarget ~= SliderKnob then
                                                                TooltipHideTween:Play()
                                                            end
                                                        end
                                                    end
                                                end)
                                                
                                                function ElementData.SetValue(_, NewValue)
                                                    local ValueToSet = tonumber(NewValue)
                                                    if ValueToSet then
                                                        ValueToSet = math.clamp(ValueToSet, MinValue, MaxValue)
                                                        local RelativePosition = (ValueToSet - MinValue) / Range
                                                        
                                                        if StepValue ~= math.huge and StepValue ~= -math.huge then
                                                            ValueToSet = math.round(ValueToSet * StepValue) / StepValue
                                                            local KnobPosition = UDim2.fromScale((ValueToSet - MinValue) / Range, 1)
                                                            SliderKnob.Position = KnobPosition
                                                            SliderFill.Size = KnobPosition
                                                        else
                                                            SliderKnob.Position = UDim2.fromScale(RelativePosition, 0.5)
                                                            SliderFill.Size = UDim2.fromScale(RelativePosition, 1)
                                                        end
                                                        
                                                        if ElementData.Value ~= ValueToSet then
                                                            ElementData.Value = ValueToSet
                                                            local OnChanged = ElementData.OnChanged
                                                            OnChanged = type(OnChanged) == "function" and OnChanged or nil
                                                            
                                                            if OnChanged then
                                                                coroutine.resume(coroutine.create(OnChanged), ValueToSet)
                                                            end
                                                        end
                                                    end
                                                end
                                            end
                                        end
                                    end
                                end
                            }
                        end
                    }
                end
            }
        }
        
        return HubAPI
    end
}

return ModuleRoot
